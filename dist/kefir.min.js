/*! kefir - 0.1.9
 *  https://github.com/pozadi/kefir
 */
!function(a){"use strict";function b(){}function c(a){return a}function d(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function e(a){return a instanceof Array?a:Array.prototype.slice.call(a)}function f(a){var b=function(){};return b.prototype=a,new b}function g(){var a=e(arguments);if(1===a.length)return a[0];for(var b=a.shift(),c=0;c<a.length;c++)for(var f in a[c])d(a[c],f)&&(b[f]=a[c][f]);return b}function h(a,b){a.prototype=f(b.prototype),a.prototype.constructor=a;for(var c=2;c<arguments.length;c++)g(a.prototype,arguments[c]);return a}function i(a,b){for(var c in b)!d(b,c)||c in a||(a[c]=b[c]);return a}function j(a){return"[object Array]"===Object.prototype.toString.call(a[0])?a[0]:e(a)}function k(a,b,c){return a.length>b?Array.prototype.slice.call(a,b):c?null:[]}function l(a,b){var c,d,f;return m(a)?(c=a,d=null,f=[]):(c=a[0],d=a[1],f=k(a,2),m(c)||(c=d[c]),b&&(f=f.concat(e(b)))),c.apply(d,f)}function m(a){return"function"==typeof a}function n(a,b){if(null==a&&null==b)return!0;if(null==a||null==b)return!1;if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}var o={},p=o.NOTHING=["<nothing>"],q=o.END=["<end>"],r=o.NO_MORE=["<no more>"];o.BunchOfValues=function(a){this.values=a},o.bunch=function(){return new o.BunchOfValues(j(arguments))},o.Error=function(a){this.error=a},o.error=function(a){return new o.Error(a)};var s=o.Observable=function(a,b){m(a)&&(this.__onFirstIn=a),m(b)&&(this.__onLastOut=b),this.__subscribers=[]};h(s,Object,{__ClassName:"Observable",toString:function(){return"["+this.__ClassName+(this.__objName?" | "+this.__objName:"")+"]"},__onFirstIn:b,__onLastOut:b,__on:function(a){if(this.isEnded())"end"===a&&l(k(arguments,1));else{var b=("value"===a||"error"===a)&&!(this.__hasSubscribers("value")||this.__hasSubscribers("error"));this.__subscribers.push(arguments),b&&this.__onFirstIn()}},__off:function(a){if(!this.isEnded()){for(var b=0;b<this.__subscribers.length;b++)n(this.__subscribers[b],arguments)&&(this.__subscribers[b]=null);"value"!==a&&"error"!==a||this.__hasSubscribers("value")||this.__hasSubscribers("error")||this.__onLastOut()}},__send:function(a){if(!this.isEnded()){for(var b=0;b<this.__subscribers.length;b++){var c=this.__subscribers[b];if(c&&c[0]===a){var d=l(k(c,1),k(arguments,1));d===r&&this.__off.apply(this,c)}}"end"===a&&this.__clear()}},__hasSubscribers:function(a){if(this.isEnded())return!1;for(var b=0;b<this.__subscribers.length;b++)if(this.__subscribers[b]&&this.__subscribers[b][0]===a)return!0;return!1},__clear:function(){this.__onLastOut(),d(this,"__onFirstIn")&&(this.__onFirstIn=null),d(this,"__onLastOut")&&(this.__onLastOut=null),this.__subscribers=null},__sendValue:function(a){return this.__send("value",a),this},__sendError:function(a){return this.__send("error",a),this},__sendEnd:function(){return this.__send("end"),this},__sendAny:function(a){if(a===q)this.__sendEnd();else if(a instanceof o.BunchOfValues)for(var b=0;b<a.values.length;b++)this.__sendAny(a.values[b]);else a instanceof o.Error?this.__sendError(a.error):a!==p&&this.__sendValue(a);return this},onValue:function(){return this.__on.apply(this,["value"].concat(e(arguments))),this},offValue:function(){return this.__off.apply(this,["value"].concat(e(arguments))),this},onError:function(){return this.__on.apply(this,["error"].concat(e(arguments))),this},offError:function(){return this.__off.apply(this,["error"].concat(e(arguments))),this},onEnd:function(){return this.__on.apply(this,["end"].concat(e(arguments))),this},offEnd:function(){return this.__off.apply(this,["end"].concat(e(arguments))),this},onNewValue:function(){return this.onValue.apply(this,arguments)},isEnded:function(){return!this.__subscribers}});var t=o.Stream=function(){s.apply(this,arguments)};h(t,s,{__ClassName:"Stream"});var u=o.Property=function(a,b,c){s.call(this,a,b),this.__cached="undefined"!=typeof c?c:p};h(u,s,{__ClassName:"Property",hasCached:function(){return this.__cached!==p},getCached:function(){return this.__cached},__sendValue:function(a){this.isEnded()||(this.__cached=a),s.prototype.__sendValue.call(this,a)},onNewValue:function(){return this.__on.apply(this,["value"].concat(e(arguments))),this},onValue:function(){return this.hasCached()&&l(arguments,[this.__cached]),this.onNewValue.apply(this,arguments)}});var v=function(a,b,c){console.log(text,b,c)};s.prototype.log=function(a){return a||(a=this.toString()),this.onValue(v,null,a,"<value>"),this.onError(v,null,a,"<error>"),this.onEnd(v,null,a,"<end>"),this};var w=new t;w.__sendEnd(),w.__objName="Kefir.never()",o.never=function(){return w},o.OnceStream=function(a){t.call(this),this.__value=a},h(o.OnceStream,t,{__ClassName:"OnceStream",onValue:function(){return this.isEnded()||(l(arguments,[this.__value]),this.__value=null,this.__sendEnd()),this}}),o.once=function(a){return new o.OnceStream(a)},o.FromBinderStream=function(a){t.call(this),this.__subscribe=a},h(o.FromBinderStream,t,{__ClassName:"FromBinderStream",__onFirstIn:function(){var a=this;this.__usubscriber=this.__subscribe(function(b){a.__sendAny(b)})},__onLastOut:function(){m(this.__usubscriber)&&this.__usubscriber(),this.__usubscriber=null},__clear:function(){t.prototype.__clear.call(this),this.__subscribe=null}}),o.fromBinder=function(a){return new o.FromBinderStream(a)};var x={__Constructor:function(a){this.__source=a,a.onEnd(this.__sendEnd,this),a instanceof u&&this instanceof u&&a.hasCached()&&this.__handle(a.getCached())},__handle:function(a){this.__sendAny(a)},__onFirstIn:function(){this.__source.onNewValue("__handle",this),this.__source.onError("__sendError",this)},__onLastOut:function(){this.__source.offValue("__handle",this),this.__source.offError("__sendError",this)},__clear:function(){s.prototype.__clear.call(this),this.__source=null}};o.PropertyFromStream=function(a,b){u.call(this,null,null,b),this.__Constructor(a)},h(o.PropertyFromStream,u,x,{__ClassName:"PropertyFromStream"}),t.prototype.toProperty=function(a){return new o.PropertyFromStream(this,a)},u.prototype.toProperty=function(a){if("undefined"==typeof a)return this;var b=new o.PropertyFromStream(this);return b.__sendValue(a),b},o.ScanProperty=function(a,b,c){u.call(this,null,null,b),this.__fn=c,this.__Constructor(a)},h(o.ScanProperty,u,x,{__ClassName:"ScanProperty",__handle:function(a){this.__sendValue(this.__fn(this.getCached(),a))},__clear:function(){x.__clear.call(this),this.__fn=null}}),s.prototype.scan=function(a,b){return new o.ScanProperty(this,a,b)};var y={__Constructor:function(a,b){this instanceof u?u.call(this):t.call(this),this.__mapFnMeta=b?1===b.lenght?b[0]:b:null,x.__Constructor.call(this,a)},__handle:function(a){this.__sendAny(this.__mapFnMeta?l(this.__mapFnMeta,[a]):a)},__clear:function(){x.__clear.call(this),this.__mapFnMeta=null}};i(y,x),o.MappedStream=function(){this.__Constructor.apply(this,arguments)},h(o.MappedStream,t,y,{__ClassName:"MappedStream"}),o.MappedProperty=function(){this.__Constructor.apply(this,arguments)},h(o.MappedProperty,u,y,{__ClassName:"MappedProperty"}),t.prototype.map=function(){return new o.MappedStream(this,arguments)},u.prototype.map=function(){return new o.MappedProperty(this,arguments)},u.prototype.changes=function(){return new o.MappedStream(this)};var z=function(a){var b=this.fn(this.prev,a);return this.prev=a,b};s.prototype.diff=function(a,b){return this.map(z,{prev:a,fn:b})};var A=function(a,b){return a(b)?b:p};s.prototype.filter=function(a){return this.map(A,null,a)};var B=function(a,b){return a(b)?b:q};s.prototype.takeWhile=function(a){return this.map(B,null,a)};var C=function(a){return this.n<=0?q:1===this.n?o.bunch(a,q):(this.n--,a)};s.prototype.take=function(a){return this.map(C,{n:a})};var D=function(a){return this.n<=0?a:(this.n--,p)};s.prototype.skip=function(a){return this.map(D,{n:a})};var E=function(a){var b;return b=this.hasPrev&&(this.fn?this.fn(this.prev,a):this.prev===a)?p:a,this.hasPrev=!0,this.prev=a,b};s.prototype.skipDuplicates=function(a){return this.map(E,{fn:a,hasPrev:!1,prev:null})};var F=function(a){return this.skip&&this.fn(a)?p:(this.skip=!1,a)};s.prototype.skipWhile=function(a){return this.map(F,{skip:!0,fn:a})},s.prototype.sampledBy=function(a,b){var c=p,d=function(a){c=a};this.onValue(d),a.onEnd(function(){this.offValue(d)},this);var e=a.map(function(a){return c!==p?b?b(c,a):c:p});return this.onError("__sendError",e),e};var G={__initPluggable:function(){this.__plugged=[]},__clearPluggable:function(){this.__plugged=null},__handlePlugged:function(a,b){this.__sendAny(b)},__plug:function(a){if(!this.isEnded()){this.__plugged.push(a);var b=this.__plugged.length-1;this.__hasSubscribers("value")&&(a.onValue("__handlePlugged",this,b),a.onError("__sendError",this)),a.onEnd("__unplugById",this,b)}},__unplugById:function(a){if(!this.isEnded()){var b=this.__plugged[a];b&&(this.__plugged[a]=null,b.offValue("__handlePlugged",this,a),b.offError("__sendError",this),b.offEnd("__unplugById",this,a))}},__unplug:function(a){if(!this.isEnded())for(var b=0;b<this.__plugged.length;b++)this.__plugged[b]===a&&this.__unplugById(b)},__onFirstIn:function(){for(var a=0;a<this.__plugged.length;a++){var b=this.__plugged[a];b&&(b.onValue("__handlePlugged",this,a),b.onError("__sendError",this))}},__onLastOut:function(){for(var a=0;a<this.__plugged.length;a++){var b=this.__plugged[a];b&&(b.offValue("__handlePlugged",this,a),b.offError("__sendError",this))}},__hasNoPlugged:function(){if(this.isEnded())return!0;for(var a=0;a<this.__plugged.length;a++)if(this.__plugged[a])return!1;return!0}};o.Bus=function(){t.call(this),this.__initPluggable()},h(o.Bus,t,G,{__ClassName:"Bus",push:function(a){return this.__sendAny(a),this},error:function(a){return this.__sendError(a),this},plug:function(a){return this.__plug(a),this},unplug:function(a){return this.__unplug(a),this},end:function(){return this.__sendEnd(),this},__clear:function(){t.prototype.__clear.call(this),this.__clearPluggable(),this.push=b}}),o.bus=function(){return new o.Bus},o.FlatMappedStream=function(a,b){t.call(this),this.__initPluggable(),this.__sourceStream=a,this.__mapFn=b,a.onEnd(this.__onSourceEnds,this)},h(o.FlatMappedStream,t,G,{__ClassName:"FlatMappedStream",__onSourceEnds:function(){this.__hasNoPlugged()&&this.__sendEnd()},__plugResult:function(a){this.__plug(this.__mapFn(a))},__onFirstIn:function(){this.__sourceStream.onValue("__plugResult",this),this.__sourceStream.onError("__sendError",this),G.__onFirstIn.call(this)},__onLastOut:function(){this.__sourceStream.offValue("__plugResult",this),this.__sourceStream.offError("__sendError",this),G.__onLastOut.call(this)},__unplugById:function(a){G.__unplugById.call(this,a),!this.isEnded()&&this.__hasNoPlugged()&&this.__sourceStream.isEnded()&&this.__sendEnd()},__clear:function(){t.prototype.__clear.call(this),this.__clearPluggable(),this.__sourceStream=null,this.__mapFn=null}}),s.prototype.flatMap=function(a){return new o.FlatMappedStream(this,a)},o.MergedStream=function(){t.call(this),this.__initPluggable();for(var a=j(arguments),b=0;b<a.length;b++)this.__plug(a[b])},h(o.MergedStream,t,G,{__ClassName:"MergedStream",__clear:function(){t.prototype.__clear.call(this),this.__clearPluggable()},__unplugById:function(a){G.__unplugById.call(this,a),this.__hasNoPlugged()&&this.__sendEnd()}}),o.merge=function(){return new o.MergedStream(j(arguments))},s.prototype.merge=function(){return o.merge([this].concat(j(arguments)))},o.CombinedStream=function(a,b){t.call(this),this.__initPluggable();for(var c=0;c<a.length;c++)this.__plug(a[c]);this.__cachedValues=new Array(a.length),this.__hasCached=new Array(a.length),this.__mapFn=b},h(o.CombinedStream,t,G,{__ClassName:"CombinedStream",__unplugById:function(a){G.__unplugById.call(this,a),this.__hasNoPlugged()&&this.__sendEnd()},__handlePlugged:function(a,b){this.__hasCached[a]=!0,this.__cachedValues[a]=b,this.__allCached()&&(m(this.__mapFn)?this.__sendAny(this.__mapFn.apply(null,this.__cachedValues)):this.__sendValue(this.__cachedValues.slice(0)))},__allCached:function(){for(var a=0;a<this.__hasCached.length;a++)if(!this.__hasCached[a])return!1;return!0},__clear:function(){t.prototype.__clear.call(this),this.__clearPluggable(),this.__cachedValues=null,this.__hasCached=null,this.__mapFn=null}}),o.combine=function(a,b){return new o.CombinedStream(a,b)},s.prototype.combine=function(a,b){return o.combine([this].concat(a),b)},o.onValues=function(a){var b=k(arguments,1);return o.combine(a).onValue(function(a){return l(b,a)})};var H=o.FromPollStream=function(a,b){t.call(this),this.__interval=a,this.__intervalId=null;var c=this;1===b.length&&(b=b[0]),this.__bindedSend=function(){c.__sendAny(l(b))}};h(H,t,{__ClassName:"FromPollStream",__onFirstIn:function(){this.__intervalId=setInterval(this.__bindedSend,this.__interval)},__onLastOut:function(){null!==this.__intervalId&&(clearInterval(this.__intervalId),this.__intervalId=null)},__clear:function(){t.prototype.__clear.call(this),this.__bindedSend=null}}),o.fromPoll=function(a){return new H(a,k(arguments,1))},o.interval=function(a,b){return new H(a,[c,null,b])};var I=function(){return 0===this.xs.length?q:1===this.xs.length?o.bunch(this.xs[0],q):this.xs.shift()};o.sequentially=function(a,b){return new H(a,[I,{xs:b.slice(0)}])};var J=function(){return this.i=(this.i+1)%this.xs.length,this.xs[this.i]};o.repeatedly=function(a,b){return new H(a,[J,{i:-1,xs:b}])},"function"==typeof define&&define.amd?(define([],function(){return o}),a.Kefir=o):"object"==typeof module&&"object"==typeof exports?(module.exports=o,o.Kefir=o):a.Kefir=o}(this);