/*! Kefir - 0.1.0
 *  https://github.com/pozadi/kefir
 */
!function(a){"use strict";function b(a){var b=function(){};return b.prototype=a,new b}function c(a,c){return a.prototype=b(c.prototype),a.prototype.constructor=a,a}function d(a,b){for(var c=0;c<a.length;)a[c]===b?a.splice(c,1):c++}function e(a,b){for(var c=0;c<a.length;c++)a[c]===b&&(a[c]=null)}function f(a){for(var b=0;b<a.length;b++)if(a[b])return!1;return!0}function g(){}function h(a){return"[object Array]"===Object.prototype.toString.call(a[0])?a[0]:Array.prototype.slice.call(a)}var i={};i.END=["<end>"],i.NO_MORE=["<no more>"],i.Stream=function(a,b){"function"==typeof a&&(this.__onFirstSubscribed=a),"function"==typeof a&&(this.__onLastUsubscribed=b),this.__subscribers=[],this.__endSubscribers=[]},i.Stream.prototype._send=function(a){if(!this.isEnded())if(a===i.END)this.__end();else for(var b=0;b<this.__subscribers.length;b++){var c=this.__subscribers[b];"function"==typeof c&&i.NO_MORE===c(a)&&this.unsubscribe(c)}},i.Stream.prototype.subscribe=function(a){this.isEnded()||(this.__subscribers.push(a),1===this.__subscribers.length&&this.__onFirstSubscribed())},i.Stream.prototype.unsubscribe=function(a){this.isEnded()||(e(this.__subscribers,a),f(this.__subscribers)&&(this.__subscribers=[],this.__onLastUsubscribed()))},i.Stream.prototype.onEnd=function(a){this.isEnded()?a():this.__endSubscribers.push(a)},i.Stream.prototype.offEnd=function(a){this.isEnded()||d(this.__endSubscribers,a)},i.Stream.prototype.isEnded=function(){return null===this.__subscribers},i.Stream.prototype.hasSubscribers=function(){return!this.isEnded()&&this.__subscribers.length>0},i.Stream.prototype.__onFirstSubscribed=g,i.Stream.prototype.__onLastUsubscribed=g,i.Stream.prototype.__end=function(){if(!this.isEnded()){this.__onLastUsubscribed(),this.hasOwnProperty(this.__onFirstSubscribed)&&(this.__onFirstSubscribed=null),this.hasOwnProperty(this.__onLastUsubscribed)&&(this.__onLastUsubscribed=null),this.__subscribers=null;for(var a=0;a<this.__endSubscribers.length;a++)this.__endSubscribers[a]();this.__endSubscribers=null}},i.__neverObj=b(i.Stream.prototype),i.__neverObj.__subscribers=null,i.never=function(){return i.__neverObj},i.Once=c(function(a){i.Stream.call(this),this.__value=a},i.Stream),i.Once.prototype.__onFirstSubscribed=function(){this._send(this.__value),this.__value=null,this._send(i.END)},i.once=function(a){return new i.Once(a)},i.Property=c(function(a,b,c){i.Stream.call(this,a,b),this.__hasCached="undefined"!=typeof c,this.__cached=c},i.Stream),i.Property.prototype.subscribe=function(a){this.__hasCached&&a(this.__cached),i.Stream.prototype.subscribe.call(this,a)},i.Property.prototype._send=function(a){this.__hasCached=!0,this.isEnded()||(this.__cached=a),i.Stream.prototype._send.call(this,a)},i.toProperty=function(a,b){var c=function(a){f._send(a)},d=function(){a.subscribe(c)},e=function(){a.unsubscribe(c)};a.onEnd(function(){f._send(i.END)});var f=new i.Property(d,e,b);return f},i.Stream.prototype.toProperty=function(a){return i.toProperty(this,a)},i.FromBinderStream=c(function(a){i.Stream.call(this),this.__generator=a;var b=this;this.__deliver=function(a){b._send(a)}},i.Stream),i.FromBinderStream.prototype.__onFirstSubscribed=function(){this.__generatorUsubscriber=this.__generator(this.__deliver)},i.FromBinderStream.prototype.__onLastUsubscribed=function(){"function"==typeof this.__generatorUsubscriber&&this.__generatorUsubscriber(),this.__generatorUsubscriber=null},i.FromBinderStream.prototype.__end=function(){i.Stream.prototype.__end.call(this),this.__generator=null,this.__deliver=null},i.fromBinder=function(a){return new i.FromBinderStream(a)},i.Bus=c(function(){i.Stream.call(this),this.__plugged=[];var a=this;this.push=function(b){a._send(b)}},i.Stream),i.Bus.prototype.plug=function(a){if(!this.isEnded()){this.__plugged.push(a),this.hasSubscribers()&&a.subscribe(this.push);var b=this;a.onEnd(function(){b.unplug(a)})}},i.Bus.prototype.unplug=function(a){this.isEnded()||(a.unsubscribe(this.push),d(this.__plugged,a))},i.Bus.prototype.end=function(){this._send(i.END)},i.Bus.prototype.__onFirstSubscribed=function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].subscribe(this.push)},i.Bus.prototype.__onLastUsubscribed=function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].unsubscribe(this.push)},i.Bus.prototype.__end=function(){i.Stream.prototype.__end.call(this),this.__plugged=null,this.push=g},i.MappedStream=c(function(a,b){i.Stream.call(this),this.__sourceStream=a;var c=this;this.__deliver=function(a){c._send(b(a))},a.onEnd(function(){c._send(i.END)})},i.Stream),i.MappedStream.prototype.__onFirstSubscribed=function(){this.__sourceStream.subscribe(this.__deliver)},i.MappedStream.prototype.__onLastUsubscribed=function(){this.__sourceStream.unsubscribe(this.__deliver)},i.MappedStream.prototype.__end=function(){i.Stream.prototype.__end.call(this),this.__sourceStream=null,this.__deliver=null},i.map=function(a,b){return new i.MappedStream(a,b)},i.Stream.prototype.map=function(a){return i.map(this,a)},i.FilteredStream=c(function(a,b){i.Stream.call(this),this.__sourceStream=a;var c=this;this.__deliver=function(a){b(a)&&c._send(a)},a.onEnd(function(){c._send(i.END)})},i.MappedStream),i.filter=function(a,b){return new i.FilteredStream(a,b)},i.Stream.prototype.filter=function(a){return i.filter(this,a)},i.TakeWhileStream=c(function(a,b){i.Stream.call(this),this.__sourceStream=a;var c=this;this.__deliver=function(a){c._send(b(a)?a:i.END)},a.onEnd(function(){c._send(i.END)})},i.MappedStream),i.takeWhile=function(a,b){return new i.TakeWhileStream(a,b)},i.Stream.prototype.takeWhile=function(a){return i.takeWhile(this,a)},i.take=function(a,b){return new i.TakeWhileStream(a,function(){return b-->0})},i.Stream.prototype.take=function(a){return i.take(this,a)},i.FlatMappedStream=c(function(a,b){i.Stream.call(this),this.__sourceStream=a,this.__plugged=[];var c=this;this.__deliver=function(a){c._send(a)},this.__plugResult=function(a){c.__plug(b(a))},a.onEnd(function(){c._send(i.END)})},i.Stream),i.FlatMappedStream.prototype.__onFirstSubscribed=function(){this.__sourceStream.subscribe(this.__plugResult);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].subscribe(this.__deliver)},i.FlatMappedStream.prototype.__onLastUsubscribed=function(){this.__sourceStream.unsubscribe(this.__plugResult);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].unsubscribe(this.__deliver)},i.FlatMappedStream.prototype.__plug=function(a){this.__plugged.push(a),this.hasSubscribers()&&a.subscribe(this.__deliver);var b=this;a.onEnd(function(){b.__unplug(a)})},i.FlatMappedStream.prototype.__unplug=function(a){this.isEnded()||(a.unsubscribe(this.__deliver),d(this.__plugged,a))},i.FlatMappedStream.prototype.__end=function(){i.Stream.prototype.__end.call(this),this.__sourceStream=null,this.__deliver=null,this.__plugResult=null,this.__plugged=null},i.flatMap=function(a,b){return new i.FlatMappedStream(a,b)},i.Stream.prototype.flatMap=function(a){return i.flatMap(this,a)},i.MergedStream=c(function(){i.Stream.call(this),this.__sourceStreams=h(arguments);var a=this;this.__deliver=function(b){a._send(b)};for(var b=0;b<this.__sourceStreams.length;b++)this.__sourceStreams[b].onEnd(this.__unplugFor(this.__sourceStreams[b]))},i.Stream),i.MergedStream.prototype.__onFirstSubscribed=function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a].subscribe(this.__deliver)},i.MergedStream.prototype.__onLastUsubscribed=function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a].unsubscribe(this.__deliver)},i.MergedStream.prototype.__unplug=function(a){a.unsubscribe(this.__deliver),d(this.__sourceStreams,a),0===this.__sourceStreams.length&&this._send(i.END)},i.MergedStream.prototype.__unplugFor=function(a){var b=this;return function(){b.__unplug(a)}},i.MergedStream.prototype.__end=function(){i.Stream.prototype.__end.call(this),this.__sourceStreams=null,this.__deliver=null},i.merge=function(){return new i.MergedStream(h(arguments))},i.Stream.prototype.merge=function(){return i.merge([this].concat(h(arguments)))},i.CombinedStream=c(function(a,b){i.Stream.call(this),this.__sourceStreams=a,this.__cachedValues=new Array(a.length),this.__hasCached=new Array(a.length),this.__receiveFns=new Array(a.length),this.__mapFn=b;for(var c=0;c<this.__sourceStreams.length;c++)this.__receiveFns[c]=this.__receiveFor(c),this.__sourceStreams[c].onEnd(this.__unplugFor(c))},i.Stream),i.CombinedStream.prototype.__onFirstSubscribed=function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a]&&this.__sourceStreams[a].subscribe(this.__receiveFns[a])},i.CombinedStream.prototype.__onLastUsubscribed=function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a]&&this.__sourceStreams[a].unsubscribe(this.__receiveFns[a])},i.CombinedStream.prototype.__unplug=function(a){this.__sourceStreams[a].unsubscribe(this.__receiveFns[a]),this.__sourceStreams[a]=null,this.__receiveFns[a]=null,this.__allDead()&&this._send(i.END)},i.CombinedStream.prototype.__unplugFor=function(a){var b=this;return function(){b.__unplug(a)}},i.CombinedStream.prototype.__receive=function(a,b){this.__hasCached[a]=!0,this.__cachedValues[a]=b,this.__allCached()&&this._send("function"==typeof this.__mapFn?this.__mapFn.apply(null,this.__cachedValues):this.__cachedValues.slice(0))},i.CombinedStream.prototype.__receiveFor=function(a){var b=this;return function(c){b.__receive(a,c)}},i.CombinedStream.prototype.__allCached=function(){for(var a=0;a<this.__hasCached.length;a++)if(!this.__hasCached[a])return!1;return!0},i.CombinedStream.prototype.__allDead=function(){for(var a=0;a<this.__sourceStreams.length;a++)if(this.__sourceStreams[a])return!1;return!0},i.CombinedStream.prototype.__end=function(){i.Stream.prototype.__end.call(this),this.__sourceStreams=null,this.__cachedValues=null,this.__hasCached=null,this.__receiveFns=null,this.__mapFn=null},i.combine=function(a,b){return new i.CombinedStream(a,b)},i.Stream.prototype.combine=function(a,b){return i.combine([this].concat(a),b)},i.Stream.prototype.log=function(a){this.subscribe(function(b){a?console.log(a,b):console.log(b)})},"function"==typeof define&&define.amd?(define([],function(){return i}),a.Kefir=i):"object"==typeof module&&"object"==typeof exports?(module.exports=i,i.Kefir=i):a.Kefir=i}(this);