/*! kefir - 0.1.6
 *  https://github.com/pozadi/kefir
 */
!function(a){"use strict";function b(){}function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function d(a){return a instanceof Array?a:Array.prototype.slice.call(a)}function e(a){var b=function(){};return b.prototype=a,new b}function f(){var a=d(arguments);if(1===a.length)return a[0];for(var b=a.shift(),e=0;e<a.length;e++)for(var f in a[e])c(a[e],f)&&(b[f]=a[e][f]);return b}function g(a,b){a.prototype=e(b.prototype),a.prototype.constructor=a;for(var c=2;c<arguments.length;c++)f(a.prototype,arguments[c]);return a}function h(a,b){for(var d in b)!c(b,d)||d in a||(a[d]=b[d]);return a}function i(a,b){for(var c=0;c<a.length;)a[c]===b?a.splice(c,1):c++}function j(a){for(var b=0;b<a.length;b++)if(null!=a[b])return!1;return!0}function k(a){return"[object Array]"===Object.prototype.toString.call(a[0])?a[0]:d(a)}function l(a,b,c){return a.length>b?Array.prototype.slice.call(a,b):c?null:[]}function m(a,b){var c=a[1],e=a[2],f=l(a,3);return b&&(f=f.concat(d(b))),c.apply(e,f)}function n(a,b){if(!a)throw new Error(b)}function o(a){n(a instanceof x,"not a Property: "+a)}function p(a){return"function"==typeof a}function q(a,b){return b.__objName=a,b}function r(a,b){if(null==a&&null==b)return!0;if(null==a||null==b)return!1;if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}var s={},t=(s.NOTHING=["<nothing>"],s.END=["<end>"]),u=s.NO_MORE=["<no more>"];s.BunchOfValues=function(a){this.values=a},s.bunch=function(){return new s.BunchOfValues(k(arguments))};var v=s.Observable=function(a,b){p(a)&&(this.__onFirstIn=a),p(b)&&(this.__onLastOut=b),this.__subscribers=[]};g(v,Object,{__ClassName:"Observable",toString:function(){return"["+this.__ClassName+(this.__objName?" | "+this.__objName:"")+"]"},__onFirstIn:b,__onLastOut:b,__on:function(a){if(this.isEnded())"end"===a&&m(arguments);else{var b="value"===a&&!this.__hasSubscribers("value");this.__subscribers.push(arguments),b&&this.__onFirstIn()}},__off:function(a){if(!this.isEnded())for(var b=0;b<this.__subscribers.length;b++)r(this.__subscribers[b],arguments)&&(this.__subscribers[b]=null),"value"!==a||this.__hasSubscribers("value")||this.__onLastOut()},__send:function(a){if(!this.isEnded()){for(var b=0;b<this.__subscribers.length;b++){var c=this.__subscribers[b];if(c&&c[0]===a){var d=m(c,l(arguments,1));d===u&&this.__off.apply(this,c)}}"end"===a&&this.__clear()}},__hasSubscribers:function(a){if(this.isEnded())return!1;for(var b=0;b<this.__subscribers.length;b++)if(this.__subscribers[b]&&this.__subscribers[b][0]===a)return!0;return!1},__clear:function(){this.__onLastOut(),c(this,"__onFirstIn")&&(this.__onFirstIn=null),c(this,"__onLastOut")&&(this.__onLastOut=null),this.__subscribers=null},__sendValue:function(a){this.__send("value",a)},__sendEnd:function(){this.__send("end")},__sendAny:function(a){if(a===t)this.__sendEnd();else if(a instanceof s.BunchOfValues)for(var b=0;b<a.values.length;b++)this.__sendAny(a.values[b]);else a!==s.NOTHING&&this.__sendValue(a)},onValue:function(){this.__on.apply(this,["value"].concat(d(arguments)))},offValue:function(){this.__off.apply(this,["value"].concat(d(arguments)))},onEnd:function(){this.__on.apply(this,["end"].concat(d(arguments)))},offEnd:function(){this.__off.apply(this,["end"].concat(d(arguments)))},onNewValue:function(){this.onValue.apply(this,arguments)},isEnded:function(){return!this.__subscribers}});var w=s.Stream=function(){v.apply(this,arguments)};g(w,v,{__ClassName:"Stream"});var x=s.Property=function(a,b,c){v.call(this,a,b),this.__cached="undefined"!=typeof c?c:s.NOTHING};g(x,v,{__ClassName:"Property",hasCached:function(){return this.__cached!==s.NOTHING},getCached:function(){return this.__cached},__sendValue:function(a){this.isEnded()||(this.__cached=a),v.prototype.__sendValue.call(this,a)},onNewValue:function(){this.__on.apply(this,["value"].concat(d(arguments)))},onValue:function(){this.hasCached()&&m(["value"].concat(d(arguments)),[this.__cached]),this.onNewValue.apply(this,arguments)}}),v.prototype.log=function(a){function b(b){console.log(a,b)}a||(a=this.toString()),this.onValue(b),this.onEnd(function(){b(t)})};var y=new w;y.__sendEnd(),y.__objName="Kefir.never()",s.never=function(){return y},s.OnceStream=function(a){w.call(this),this.__value=a},g(s.OnceStream,w,{__ClassName:"OnceStream",__objName:"Kefir.once(x)",__onFirstIn:function(){this.__sendValue(this.__value),this.__value=null,this.__sendEnd()}}),s.once=function(a){return new s.OnceStream(a)},s.FromBinderStream=function(a){w.call(this),this.__subscribe=a},g(s.FromBinderStream,w,{__ClassName:"FromBinderStream",__objName:"Kefir.fromBinder(subscribe)",__onFirstIn:function(){var a=this;this.__usubscriber=this.__subscribe(function(b){a.__sendAny(b)})},__onLastOut:function(){p(this.__usubscriber)&&this.__usubscriber(),this.__usubscriber=null},__clear:function(){w.prototype.__clear.call(this),this.__subscribe=null}}),s.fromBinder=function(a){return new s.FromBinderStream(a)};var z={__Constructor:function(a){this.__source=a,a.onEnd(this.__sendEnd,this),a instanceof x&&this instanceof x&&a.hasCached()&&this.__handle(a.getCached())},__handle:function(a){this.__sendAny(a)},__onFirstIn:function(){this.__source.onNewValue(this.__handle,this)},__onLastOut:function(){this.__source.offValue(this.__handle,this)},__clear:function(){this.__source=null}};s.PropertyFromStream=function(a,b){x.call(this,null,null,b),this.__Constructor.call(this,a)},g(s.PropertyFromStream,x,z,{__ClassName:"PropertyFromStream",__objName:"stream.toProperty()",__clear:function(){x.prototype.__clear.call(this),z.__clear.call(this)}}),w.prototype.toProperty=function(a){return new s.PropertyFromStream(this,a)},x.prototype.toProperty=function(a){if("undefined"==typeof a)return this;var b=new s.PropertyFromStream(this);return b.__sendValue(a),b},s.ChangesStream=function(a){o(a),w.call(this),this.__Constructor.call(this,a)},g(s.ChangesStream,w,z,{__ClassName:"ChangesStream",__objName:"property.changes()",__clear:function(){w.prototype.__clear.call(this),z.__clear.call(this)}}),x.prototype.changes=function(){return new s.ChangesStream(this)};var A={__Constructor:function(a,b){a instanceof x?x.call(this):w.call(this),this.__mapFn=b,z.__Constructor.call(this,a)},__handle:function(a){this.__sendAny(this.__mapFn(a))},__clear:function(){w.prototype.__clear.call(this),z.__clear.call(this),this.__mapFn=null}};h(A,z),s.MappedStream=function(){this.__Constructor.apply(this,arguments)},g(s.MappedStream,w,A,{__ClassName:"MappedStream"}),s.MappedProperty=function(){this.__Constructor.apply(this,arguments)},g(s.MappedProperty,x,A,{__ClassName:"MappedProperty"}),v.prototype.map=function(a){return this instanceof x?new s.MappedProperty(this,a):new s.MappedStream(this,a)};var B={__handle:function(a){this.__mapFn(a)&&this.__sendValue(a)}};h(B,A),s.FilteredStream=function(){this.__Constructor.apply(this,arguments)},g(s.FilteredStream,w,B,{__ClassName:"FilteredStream"}),s.FilteredProperty=function(){this.__Constructor.apply(this,arguments)},g(s.FilteredProperty,x,B,{__ClassName:"FilteredProperty"}),v.prototype.filter=function(a){return this instanceof x?new s.FilteredProperty(this,a):new s.FilteredStream(this,a)};var C={__handle:function(a){this.__mapFn(a)?this.__sendValue(a):this.__sendEnd()}};h(C,A),s.TakeWhileStream=function(){this.__Constructor.apply(this,arguments)},g(s.TakeWhileStream,w,C,{__ClassName:"TakeWhileStream"}),s.TakeWhileProperty=function(){this.__Constructor.apply(this,arguments)},g(s.TakeWhileProperty,x,C,{__ClassName:"TakeWhileStream"}),v.prototype.takeWhile=function(a){return this instanceof x?new s.TakeWhileProperty(this,a):new s.TakeWhileStream(this,a)},v.prototype.take=function(a){return q("observable.take(n)",this.takeWhile(function(){return a-->0}))},s.Bus=function(){w.call(this),this.__plugged=[]},g(s.Bus,w,{__ClassName:"Bus",__objName:"Kefir.bus()",push:function(a){this.__sendAny(a)},plug:function(a){this.isEnded()||(this.__plugged.push(a),this.__hasSubscribers("value")&&a.onValue(this.__sendValue,this),a.onEnd(this.unplug,this,a))},unplug:function(a){this.isEnded()||(a.offValue(this.__sendValue,this),i(this.__plugged,a))},end:function(){this.__sendEnd()},__onFirstIn:function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].onValue(this.__sendValue,this)},__onLastOut:function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].offValue(this.__sendValue,this)},__clear:function(){w.prototype.__clear.call(this),this.__plugged=null,this.push=b}}),s.bus=function(){return new s.Bus},s.FlatMappedStream=function(a,b){w.call(this),this.__sourceStream=a,this.__plugged=[],this.__mapFn=b,a.onEnd(this.__sendEnd,this)},g(s.FlatMappedStream,w,{__ClassName:"FlatMappedStream",__objName:"observable.flatMap(fn)",__plugResult:function(a){this.__plug(this.__mapFn(a))},__onFirstIn:function(){this.__sourceStream.onValue(this.__plugResult,this);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].onValue(this.__sendValue,this)},__onLastOut:function(){this.__sourceStream.offValue(this.__plugResult,this);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].offValue(this.__sendValue,this)},__plug:function(a){this.__plugged.push(a),this.__hasSubscribers("value")&&a.onValue(this.__sendValue,this),a.onEnd(this.__unplug,this,a)},__unplug:function(a){this.isEnded()||(a.offValue(this.__sendValue,this),i(this.__plugged,a))},__clear:function(){w.prototype.__clear.call(this),this.__sourceStream=null,this.__mapFn=null,this.__plugged=null}}),v.prototype.flatMap=function(a){return new s.FlatMappedStream(this,a)},s.MergedStream=function(){w.call(this),this.__sources=k(arguments);for(var a=0;a<this.__sources.length;a++)this.__sources[a].onEnd(this.__unplug,this,this.__sources[a])},g(s.MergedStream,w,{__ClassName:"MergedStream",__objName:"Kefir.merge(streams)",__onFirstIn:function(){for(var a=0;a<this.__sources.length;a++)this.__sources[a].onNewValue(this.__sendValue,this)},__onLastOut:function(){for(var a=0;a<this.__sources.length;a++)this.__sources[a].offValue(this.__sendValue,this)},__unplug:function(a){a.offValue(this.__sendValue,this),i(this.__sources,a),0===this.__sources.length&&this.__sendEnd()},__clear:function(){w.prototype.__clear.call(this),this.__sources=null}}),s.merge=function(){return new s.MergedStream(k(arguments))},w.prototype.merge=function(){return s.merge([this].concat(k(arguments)))},s.CombinedStream=function(a,b){w.call(this),this.__sources=a,this.__cachedValues=new Array(a.length),this.__hasCached=new Array(a.length),this.__mapFn=b;for(var c=0;c<this.__sources.length;c++)this.__sources[c].onEnd(this.__unplug,this,c)},g(s.CombinedStream,w,{__ClassName:"CombinedStream",__objName:"Kefir.combine(streams, fn)",__onFirstIn:function(){for(var a=0;a<this.__sources.length;a++)this.__sources[a]&&this.__sources[a].onValue(this.__receive,this,a)},__onLastOut:function(){for(var a=0;a<this.__sources.length;a++)this.__sources[a]&&this.__sources[a].offValue(this.__receive,this,a)},__unplug:function(a){this.__sources[a].offValue(this.__receive,this,a),this.__sources[a]=null,j(this.__sources)&&this.__sendEnd()},__receive:function(a,b){this.__hasCached[a]=!0,this.__cachedValues[a]=b,this.__allCached()&&(p(this.__mapFn)?this.__sendAny(this.__mapFn.apply(null,this.__cachedValues)):this.__sendValue(this.__cachedValues.slice(0)))},__allCached:function(){for(var a=0;a<this.__hasCached.length;a++)if(!this.__hasCached[a])return!1;return!0},__clear:function(){w.prototype.__clear.call(this),this.__sources=null,this.__cachedValues=null,this.__hasCached=null,this.__mapFn=null}}),s.combine=function(a,b){return new s.CombinedStream(a,b)},v.prototype.combine=function(a,b){return s.combine([this].concat(a),b)};var D=s.FromPollStream=function(a,b){w.call(this),this.__interval=a,this.__intervalId=null;var c=this;this.__bindedSend=function(){c.__sendAny(b())}};g(D,w,{__ClassName:"FromPollStream",__objName:"Kefir.fromPoll(interval, fn)",__onFirstIn:function(){this.__intervalId=setInterval(this.__bindedSend,this.__interval)},__onLastOut:function(){null!==this.__intervalId&&(clearInterval(this.__intervalId),this.__intervalId=null)},__clear:function(){w.prototype.__clear.call(this),this.__bindedSend=null}}),s.fromPoll=function(a,b){return q("Kefir.fromPoll(interval, fn)",new D(a,b))},s.interval=function(a,b){return q("Kefir.interval(interval, x)",new D(a,function(){return b}))},s.sequentially=function(a,b){return b=b.slice(0),q("Kefir.sequentially(interval, xs)",new D(a,function(){return 0===b.length?t:1===b.length?s.bunch(b[0],t):b.shift()}))},s.repeatedly=function(a,b){var c=-1;return q("Kefir.repeatedly(interval, xs)",new D(a,function(){return b[++c%b.length]}))},"function"==typeof define&&define.amd?(define([],function(){return s}),a.Kefir=s):"object"==typeof module&&"object"==typeof exports?(module.exports=s,s.Kefir=s):a.Kefir=s}(this);