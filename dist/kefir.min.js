/*! Kefir - 0.1.0
 *  https://github.com/pozadi/kefir
 */
!function(){"use strict";function a(a){var b=function(){};return b.prototype=a,new b}function b(b,c){return b.prototype=a(c.prototype),b.prototype.constructor=b,b.prototype.__superConstructor=c,b.prototype.__superProto=c.prototype,b}function c(a,b){for(var c=0;c<a.length;)a[c]===b?a.splice(c,1):c++}function d(a){return"[object Array]"===Object.prototype.toString.call(a[0])?a[0]:Array.prototype.slice.call(a)}var e={};e.END=["<end>"],e.Stream=function(a){if(!a)return void this._end();this.__generator=a,this.__subscribers=[],this.__endSubscribers=[],this.__generatorUsubscriber=null;var b=this;this.__deliver=function(a){if(!b.isEnded())if(a===e.END)b._end();else for(var c=0;c<b.__subscribers.length;c++)b.__subscribers[c](a)}},e.Stream.prototype.__subToGenerator=function(){null===this.__generatorUsubscriber&&this.__generator&&(this.__generatorUsubscriber=this.__generator(this.__deliver))},e.Stream.prototype.__unsubFromGenerator=function(){this.__generatorUsubscriber&&(this.__generatorUsubscriber(),this.__generatorUsubscriber=null)},e.Stream.prototype._end=function(){if(!this.isEnded()){this.__unsubFromGenerator(),this.__subscribers=null,this.__generator=null,this.__deliver=null;for(var a=0;a<this.__endSubscribers.length;a++)this.__endSubscribers[a]();this.__endSubscribers=null}},e.Stream.prototype.subscribe=function(a){this.__generator&&(this.__subToGenerator(),this.__subscribers.push(a))},e.Stream.prototype.unsubscribe=function(a){!this.isEnded()&&this.__subscribers.length>0&&(c(this.__subscribers,a),0===this.__subscribers.length&&this.__unsubFromGenerator())},e.Stream.prototype.onEnd=function(a){this.isEnded()?a():this.__endSubscribers.push(a)},e.Stream.prototype.offEnd=function(a){this.isEnded()||c(this.__endSubscribers,a)},e.Stream.prototype.isEnded=function(){return null===this.__generator},e.Stream.prototype.hasListeners=function(){return null!==this.__generatorUsubscriber},e.Bus=b(function(){this.__plugged=[],this.__listeningToPlugged=!1;var a=this;this.__superConstructor(function(b){return a.__sink=b,function(){a.__sink=null}}),this.push=function(b){a.__sink&&a.__sink(b)}},e.Stream),e.Bus.prototype.__startListenToPlugged=function(){if(this.__plugged&&!this.__listeningToPlugged){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].subscribe(this.push);this.__listeningToPlugged=!0}},e.Bus.prototype.__stopListenToPlugged=function(){if(this.__plugged&&this.__listeningToPlugged){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].unsubscribe(this.push);this.__listeningToPlugged=!1}},e.Bus.prototype.__subToGenerator=function(){this.__superProto.__subToGenerator.apply(this),this.__startListenToPlugged()},e.Bus.prototype.__unsubFromGenerator=function(){this.__superProto.__unsubFromGenerator.apply(this),this.__stopListenToPlugged()},e.Bus.prototype._end=function(){this.__superProto._end.apply(this),this.__stopListenToPlugged(),this.__plugged=null},e.Bus.prototype.end=function(){this._end()},e.Bus.prototype.plug=function(a){this.__plugged.push(a),this.__sink&&a.subscribe(this.push);var b=this;a.onEnd(function(){b.unplug(a)})},e.Bus.prototype.unplug=function(a){a.unsubscribe(this.push),c(this.__plugged,a)},e.map=function(a,b){var c=new e.Stream(function(c){var d=function(a){c(b(a))};return a.subscribe(d),function(){a.unsubscribe(d)}});return a.onEnd(function(){c._end()}),c},e.Stream.prototype.map=function(a){return e.map(this,a)},e.merge=function(){function a(a){a.onEnd(function(){a.unsubscribe(f),c(b,a),0===b.length&&g._end()})}for(var b=d(arguments),f=null,g=new e.Stream(function(a){f=a;for(var c=0;c<b.length;c++)b[c].subscribe(a);return function(){for(var c=0;c<b.length;c++)b[c].unsubscribe(a);f=null}}),h=0;h<b.length;h++)a(b[h]);return g},e.Stream.prototype.merge=function(){return e.merge([this].concat(d(arguments)))},e.Stream.prototype.log=function(a){this.subscribe(function(b){a?console.log(a,b):console.log(b)})},"function"==typeof define&&define.amd?(define([],function(){return e}),this.Kefir=e):"object"==typeof module&&"object"==typeof exports?(module.exports=e,e.Kefir=e):this.Kefir=e}();