/*! kefir - 0.1.6
 *  https://github.com/pozadi/kefir
 */
!function(a){"use strict";function b(){}function c(a){return a}function d(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function e(a){return Array.prototype.slice.call(a)}function f(a){var b=function(){};return b.prototype=a,new b}function g(){var a=e(arguments);if(1===a.length)return a[0];for(var b=a.shift(),c=0;c<a.length;c++)for(var f in a[c])d(a[c],f)&&(b[f]=a[c][f]);return b}function h(a,b,c){return a.prototype=f(b.prototype),a.prototype.constructor=a,c&&g(a.prototype,c),a}function i(a,b){for(var c=0;c<a.length;)a[c]===b?a.splice(c,1):c++}function j(a){for(var b=0;b<a.length;b++)if(a[b])return!1;return!0}function k(a){return"[object Array]"===Object.prototype.toString.call(a[0])?a[0]:e(a)}function l(a,b){if(!a)throw new Error(b)}function m(a){l(a instanceof u,"not a Stream: "+a)}function n(a){l(a instanceof w,"not a Property: "+a)}function o(a){return"function"==typeof a}function p(a,b){return b.__objName=a,b}var q={};q.END=["<end>"],q.NO_MORE=["<no more>"];var r=q.Callbacks=h(function(){this.__subscribers=null,this.__contexts=null},Object,{add:function(a,b){null===this.__subscribers&&(this.__subscribers=[],this.__contexts=[]),this.__subscribers.push(a),this.__contexts.push(b)},remove:function(a,b){if(!this.isEmpty()){for(var c=0;c<this.__subscribers.length;c++)this.__subscribers[c]===a&&this.__contexts[c]===b&&(this.__subscribers[c]=null,this.__contexts[c]=null);j(this.__subscribers)&&(this.__subscribers=null,this.__contexts=null)}},isEmpty:function(){return null===this.__subscribers},hasOne:function(){return!this.isEmpty()&&1===this.__subscribers.length},send:function(a){if(!this.isEmpty())for(var b=0,c=this.__subscribers.length;c>b;b++){var d=this.__subscribers[b],e=this.__contexts[b];o(d)&&q.NO_MORE===d.call(e,a)&&this.remove(d,e)}}}),s={__Constructor:function(a){this.__source=a,a.onEnd(this.__sendEnd,this),a instanceof w&&this instanceof w&&a.hasCached()&&this.__handle(a.getCached())},__handle:function(a){this._send(a)},__onFirstIn:function(){this.__source.onChanges(this.__handle,this)},__onLastOut:function(){this.__source.off(this.__handle,this)},__end:function(){this.__source=null}},t=q.Observable=h(function(a,b){o(a)&&(this.__onFirstIn=a),o(b)&&(this.__onLastOut=b),this.__subscribers=new r,this.__endSubscribers=new r},Object,{__ClassName:"Observable",_send:function(a){this.isEnded()||(a===q.END?this.__end():this.__deliver(a))},__deliver:function(a){this.__subscribers.isEmpty()||(this.__subscribers.send(a),this.__subscribers.isEmpty()&&this.__onLastOut())},on:function(a,b){this.isEnded()||(this.__subscribers.add(a,b),this.__subscribers.hasOne()&&this.__onFirstIn())},onChanges:function(a,b){this.on(a,b)},onValue:function(a,b){this.on(a,b)},off:function(a,b){this.isEnded()||(this.__subscribers.remove(a,b),this.__subscribers.isEmpty()&&this.__onLastOut())},onEnd:function(a,b){this.isEnded()?a.call(b):this.__endSubscribers.add(a,b)},offEnd:function(a,b){this.isEnded()||this.__endSubscribers.remove(a,b)},isEnded:function(){return null===this.__subscribers},hasSubscribers:function(){return!this.isEnded()&&!this.__subscribers.isEmpty()},__onFirstIn:b,__onLastOut:b,__sendEnd:function(){this._send(q.END)},__end:function(){this.isEnded()||(this.__onLastOut(),this.__endSubscribers.send(),d(this,"__onFirstIn")&&(this.__onFirstIn=null),d(this,"__onLastOut")&&(this.__onLastOut=null),this.__subscribers=null,this.__endSubscribers=null)},toString:function(){return"["+this.__ClassName+(this.__objName?" | "+this.__objName:"")+"]"}}),u=q.Stream=h(function(){t.apply(this,arguments)},t,{__ClassName:"Stream"}),v=new u;v._send(q.END),v.__objName="Kefir.never()",q.never=function(){return v},q.OnceStream=h(function(a){u.call(this),this.__value=a},u,{__ClassName:"OnceStream",__objName:"Kefir.once(x)",__onFirstIn:function(){this._send(this.__value),this.__value=null,this._send(q.END)}}),q.once=function(a){return new q.OnceStream(a)};var w=q.Property=h(function(a,b,c){t.call(this,a,b),this.__hasCached="undefined"!=typeof c,this.__cached=c},t,{__ClassName:"Property",onChanges:function(a,b){t.prototype.on.call(this,a,b)},on:function(a,b){this.__hasCached&&a.call(b,this.__cached),this.onChanges(a,b)},_send:function(a){this.isEnded()||(this.__hasCached=!0,this.__cached=a),t.prototype._send.call(this,a)},toProperty:function(a){return l("undefined"==typeof a,"can't convert Property to Property with new initial value"),this},hasCached:function(){return this.__hasCached},getCached:function(){return this.__cached}});q.PropertyFromStream=h(function(a,b){m(a),w.call(this,null,null,b),this.__Constructor.call(this,a)},w,g({},s,{__ClassName:"PropertyFromStream",__objName:"stream.toProperty()",__end:function(){w.prototype.__end.call(this),s.__end.call(this)}})),u.prototype.toProperty=function(a){return new q.PropertyFromStream(this,a)},q.ChangesStream=h(function(a){n(a),u.call(this),this.__Constructor.call(this,a)},u,g({},s,{__ClassName:"ChangesStream",__objName:"property.changes()",__end:function(){u.prototype.__end.call(this),s.__end.call(this)}})),w.prototype.changes=function(){return new q.ChangesStream(this)},q.FromBinderStream=h(function(a){u.call(this),this.__subscribe=a},u,{__ClassName:"FromBinderStream",__objName:"Kefir.fromBinder(subscribe)",__onFirstIn:function(){var a=this;this.__usubscriber=this.__subscribe(function(b){a._send(b)})},__onLastOut:function(){o(this.__usubscriber)&&this.__usubscriber(),this.__usubscriber=null},__end:function(){u.prototype.__end.call(this),this.__subscribe=null}}),q.fromBinder=function(a){return new q.FromBinderStream(a)},q.Bus=h(function(){u.call(this),this.__plugged=[]},u,{__ClassName:"Bus",__objName:"Kefir.bus()",push:function(a){this._send(a)},plug:function(a){if(!this.isEnded()){this.__plugged.push(a),this.hasSubscribers()&&a.on(this._send,this);var b=this;a.onEnd(function(){b.unplug(a)})}},unplug:function(a){this.isEnded()||(a.off(this._send,this),i(this.__plugged,a))},end:function(){this._send(q.END)},__onFirstIn:function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].on(this._send,this)},__onLastOut:function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].off(this._send,this)},__end:function(){u.prototype.__end.call(this),this.__plugged=null,this.push=b}}),q.bus=function(){return new q.Bus};var x=q.FromPollStream=h(function(a,b){u.call(this),this.__interval=a,this.__intervalId=null;var c=this;this.__send=function(){c._send(b())}},u,{__ClassName:"FromPollStream",__objName:"Kefir.fromPoll(interval, fn)",__onFirstIn:function(){this.__intervalId=setInterval(this.__send,this.__interval)},__onLastOut:function(){null!==this.__intervalId&&(clearInterval(this.__intervalId),this.__intervalId=null)},__end:function(){u.prototype.__end.call(this),this.__send=null}});q.fromPoll=function(a,b){return p("Kefir.fromPoll(interval, fn)",new x(a,b))},q.interval=function(a,b){return p("Kefir.interval(interval, x)",new x(a,function(){return b}))},q.sequentially=function(a,b){return b=b.slice(0),p("Kefir.sequentially(interval, xs)",new x(a,function(){return 0===b.length?q.END:b.shift()}))},q.repeatedly=function(a,b){var c=-1;return p("Kefir.repeatedly(interval, xs)",new x(a,function(){return b[++c%b.length]}))};var y=g({},s,{__Constructor:function(a,b){a instanceof w?w.call(this):u.call(this),this.__mapFn=b,s.__Constructor.call(this,a)},__handle:function(a){this._send(this.__mapFn(a))},__end:function(){u.prototype.__end.call(this),s.__end.call(this),this.__mapFn=null}});q.MappedStream=h(function(){this.__Constructor.apply(this,arguments)},u,y),q.MappedStream.prototype.__ClassName="MappedStream",q.MappedProperty=h(function(){this.__Constructor.apply(this,arguments)},w,y),q.MappedProperty.prototype.__ClassName="MappedProperty",t.prototype.map=function(a){return this instanceof w?new q.MappedProperty(this,a):new q.MappedStream(this,a)};var z=g({},y,{__handle:function(a){this.__mapFn(a)&&this._send(a)}});q.FilteredStream=h(function(){this.__Constructor.apply(this,arguments)},u,z),q.FilteredStream.prototype.__ClassName="FilteredStream",q.FilteredProperty=h(function(){this.__Constructor.apply(this,arguments)},w,z),q.FilteredProperty.prototype.__ClassName="FilteredProperty",t.prototype.filter=function(a){return this instanceof w?new q.FilteredProperty(this,a):new q.FilteredStream(this,a)};var A=g({},y,{__handle:function(a){this._send(this.__mapFn(a)?a:q.END)}});q.TakeWhileStream=h(function(){this.__Constructor.apply(this,arguments)},u,A),q.TakeWhileStream.prototype.__ClassName="TakeWhileStream",q.TakeWhileProperty=h(function(){this.__Constructor.apply(this,arguments)},w,A),q.TakeWhileProperty.prototype.__ClassName="TakeWhileProperty",t.prototype.takeWhile=function(a){return this instanceof w?new q.TakeWhileProperty(this,a):new q.TakeWhileStream(this,a)},t.prototype.take=function(a){return p("observable.take(n)",this.takeWhile(function(){return a-->0}))},q.FlatMappedStream=h(function(a,b){u.call(this),this.__sourceStream=a,this.__plugged=[],this.__mapFn=b,a.onEnd(this.__sendEnd,this)},u,{__ClassName:"FlatMappedStream",__objName:"observable.flatMap(fn)",__plugResult:function(a){this.__plug(this.__mapFn(a))},__onFirstIn:function(){this.__sourceStream.on(this.__plugResult,this);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].on(this._send,this)},__onLastOut:function(){this.__sourceStream.off(this.__plugResult,this);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].off(this._send,this)},__plug:function(a){this.__plugged.push(a),this.hasSubscribers()&&a.on(this._send,this);var b=this;a.onEnd(function(){b.__unplug(a)})},__unplug:function(a){this.isEnded()||(a.off(this._send,this),i(this.__plugged,a))},__end:function(){u.prototype.__end.call(this),this.__sourceStream=null,this.__mapFn=null,this.__plugged=null}}),t.prototype.flatMap=function(a){return new q.FlatMappedStream(this,a)},q.MergedStream=h(function(){u.call(this),this.__sources=k(arguments);for(var a=0;a<this.__sources.length;a++)m(this.__sources[a]),this.__sources[a].onEnd(this.__unplugFor(this.__sources[a]))},u,{__ClassName:"MergedStream",__objName:"Kefir.merge(streams)",__onFirstIn:function(){for(var a=0;a<this.__sources.length;a++)this.__sources[a].on(this._send,this)},__onLastOut:function(){for(var a=0;a<this.__sources.length;a++)this.__sources[a].off(this._send,this)},__unplug:function(a){a.off(this._send,this),i(this.__sources,a),0===this.__sources.length&&this._send(q.END)},__unplugFor:function(a){var b=this;return function(){b.__unplug(a)}},__end:function(){u.prototype.__end.call(this),this.__sources=null}}),q.merge=function(){return new q.MergedStream(k(arguments))},u.prototype.merge=function(){return q.merge([this].concat(k(arguments)))},q.CombinedStream=h(function(a,b){u.call(this),this.__sources=a,this.__cachedValues=new Array(a.length),this.__hasCached=new Array(a.length),this.__receiveFns=new Array(a.length),this.__mapFn=b;for(var c=0;c<this.__sources.length;c++)this.__receiveFns[c]=this.__receiveFor(c),this.__sources[c].onEnd(this.__unplugFor(c))},u,{__ClassName:"CombinedStream",__objName:"Kefir.combine(streams, fn)",__onFirstIn:function(){for(var a=0;a<this.__sources.length;a++)this.__sources[a]&&this.__sources[a].on(this.__receiveFns[a])},__onLastOut:function(){for(var a=0;a<this.__sources.length;a++)this.__sources[a]&&this.__sources[a].off(this.__receiveFns[a])},__unplug:function(a){this.__sources[a].off(this.__receiveFns[a]),this.__sources[a]=null,this.__receiveFns[a]=null,j(this.__sources)&&this._send(q.END)},__unplugFor:function(a){var b=this;return function(){b.__unplug(a)}},__receive:function(a,b){this.__hasCached[a]=!0,this.__cachedValues[a]=b,this.__allCached()&&this._send(o(this.__mapFn)?this.__mapFn.apply(null,this.__cachedValues):this.__cachedValues.slice(0))},__receiveFor:function(a){var b=this;return function(c){b.__receive(a,c)}},__allCached:function(){for(var a=0;a<this.__hasCached.length;a++)if(!this.__hasCached[a])return!1;return!0},__end:function(){u.prototype.__end.call(this),this.__sources=null,this.__cachedValues=null,this.__hasCached=null,this.__receiveFns=null,this.__mapFn=null}}),q.combine=function(a,b){return new q.CombinedStream(a,b)},t.prototype.combine=function(a,b){return q.combine([this].concat(a),b)},t.prototype.log=function(a){function b(b){a?console.log(a,b):console.log(b)}this.on(b),this.onEnd(function(){b(q.END)})};var B=a.jQuery||a.Zepto||"undefined"!=typeof window&&(window.jQuery||window.Zepto);B&&(B.fn.eventStream=function(a,b,d){function e(){i._send(d.apply(this,arguments))}function f(){h.on(a,b,e)}function g(){h.off(a,b,e)}2===arguments.length&&o(b)&&(d=b,b=null),o(d)||(d=c);var h=this,i=new u(f,g);return i}),"function"==typeof define&&define.amd?(define([],function(){return q}),a.Kefir=q):"object"==typeof module&&"object"==typeof exports?(module.exports=q,q.Kefir=q):a.Kefir=q}(this);