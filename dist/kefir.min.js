/*! kefir - 0.1.6
 *  https://github.com/pozadi/kefir
 */
!function(a){"use strict";function b(){}function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function d(a){return Array.prototype.slice.call(a)}function e(a){var b=function(){};return b.prototype=a,new b}function f(){var a=d(arguments);if(1===a.length)return a[0];for(var b=a.shift(),e=0;e<a.length;e++)for(var f in a[e])c(a[e],f)&&(b[f]=a[e][f]);return b}function g(a,b){a.prototype=e(b.prototype),a.prototype.constructor=a;for(var c=2;c<arguments.length;c++)f(a.prototype,arguments[c]);return a}function h(a,b){for(var d in b)!c(b,d)||d in a||(a[d]=b[d]);return a}function i(a,b){for(var c=0;c<a.length;)a[c]===b?a.splice(c,1):c++}function j(a){for(var b=0;b<a.length;b++)if(null!=a[b])return!1;return!0}function k(a){return"[object Array]"===Object.prototype.toString.call(a[0])?a[0]:d(a)}function l(a,b,c){return a.length>b?Array.prototype.slice.call(a,b):c?null:[]}function m(a){var b=a[0],c=a[1],d=l(a,2),e=l(arguments,1);return b.apply(c,d.concat(e))}function n(a,b){if(!a)throw new Error(b)}function o(a){n(a instanceof y,"not a Stream: "+a)}function p(a){n(a instanceof z,"not a Property: "+a)}function q(a){return"function"==typeof a}function r(a,b){return b.__objName=a,b}function s(a,b){if(null==a&&null==b)return!0;if(null==a||null==b)return!1;if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}var t={},u=(t.NOTHING=["<nothing>"],t.END=["<end>"]),v=t.NO_MORE=["<no more>"];t.BunchOfValues=function(a){this.values=a},t.bunch=function(){return new t.BunchOfValues(k(arguments))};var w=t.Callbacks=function(){this.__subscribers=null};g(w,Object,{add:function(){this.__subscribers||(this.__subscribers=[]),this.__subscribers.push(arguments)},remove:function(){if(!this.isEmpty()){for(var a=0;a<this.__subscribers.length;a++)s(this.__subscribers[a],arguments)&&(this.__subscribers[a]=null);j(this.__subscribers)&&(this.__subscribers=null)}},isEmpty:function(){return!this.__subscribers},hasOne:function(){return!this.isEmpty()&&1===this.__subscribers.length},send:function(a){if(!this.isEmpty())for(var b=0,c=this.__subscribers.length;c>b;b++)this.__subscribers[b]&&v===m(this.__subscribers[b],a)&&this.remove.apply(this,this.__subscribers[b])}});var x=t.Observable=function(a,b){q(a)&&(this.__onFirstIn=a),q(b)&&(this.__onLastOut=b),this.__subscribers=new w,this.__endSubscribers=new w};g(x,Object,{__ClassName:"Observable",_send:function(a){if(!this.isEnded())if(a===u)this.__end();else if(a instanceof t.BunchOfValues)for(var b=0;b<a.values.length;b++)this._send(a.values[b]);else a!==t.NOTHING&&this.__deliver(a)},__deliver:function(a){this.__subscribers.isEmpty()||(this.__subscribers.send(a),this.__subscribers.isEmpty()&&this.__onLastOut())},on:function(){this.isEnded()||(this.__subscribers.add.apply(this.__subscribers,arguments),this.__subscribers.hasOne()&&this.__onFirstIn())},onChanges:function(){this.on.apply(this,arguments)},onValue:function(){this.on.apply(this,arguments)},off:function(){this.isEnded()||(this.__subscribers.remove.apply(this.__subscribers,arguments),this.__subscribers.isEmpty()&&this.__onLastOut())},onEnd:function(){this.isEnded()?m(arguments):this.__endSubscribers.add.apply(this.__endSubscribers,arguments)},offEnd:function(){this.isEnded()||this.__endSubscribers.remove.apply(this.__endSubscribers,arguments)},isEnded:function(){return!this.__subscribers},hasSubscribers:function(){return!this.isEnded()&&!this.__subscribers.isEmpty()},__onFirstIn:b,__onLastOut:b,__sendEnd:function(){this._send(u)},__end:function(){this.isEnded()||(this.__onLastOut(),this.__endSubscribers.send(),c(this,"__onFirstIn")&&(this.__onFirstIn=null),c(this,"__onLastOut")&&(this.__onLastOut=null),this.__subscribers=null,this.__endSubscribers=null)},toString:function(){return"["+this.__ClassName+(this.__objName?" | "+this.__objName:"")+"]"}});var y=t.Stream=function(){x.apply(this,arguments)};g(y,x,{__ClassName:"Stream"});var z=t.Property=function(a,b,c){x.call(this,a,b),this.__cached="undefined"!=typeof c?c:t.NOTHING};g(z,x,{__ClassName:"Property",onChanges:function(){x.prototype.on.apply(this,arguments)},on:function(){this.hasCached()&&m(arguments,this.__cached),this.onChanges.apply(this,arguments)},_send:function(a){this.isEnded()||(this.__cached=a),x.prototype._send.call(this,a)},toProperty:function(a){return n("undefined"==typeof a,"can't convert Property to Property with new initial value"),this},hasCached:function(){return this.__cached!==t.NOTHING},getCached:function(){return this.__cached}}),x.prototype.log=function(a){function b(b){a?console.log(a,b):console.log(b)}this.on(b),this.onEnd(function(){b(u)})};var A=new y;A._send(t.END),A.__objName="Kefir.never()",t.never=function(){return A},t.OnceStream=function(a){y.call(this),this.__value=a},g(t.OnceStream,y,{__ClassName:"OnceStream",__objName:"Kefir.once(x)",__onFirstIn:function(){this._send(this.__value),this.__value=null,this._send(t.END)}}),t.once=function(a){return new t.OnceStream(a)},t.FromBinderStream=function(a){y.call(this),this.__subscribe=a},g(t.FromBinderStream,y,{__ClassName:"FromBinderStream",__objName:"Kefir.fromBinder(subscribe)",__onFirstIn:function(){var a=this;this.__usubscriber=this.__subscribe(function(b){a._send(b)})},__onLastOut:function(){q(this.__usubscriber)&&this.__usubscriber(),this.__usubscriber=null},__end:function(){y.prototype.__end.call(this),this.__subscribe=null}}),t.fromBinder=function(a){return new t.FromBinderStream(a)};var B={__Constructor:function(a){this.__source=a,a.onEnd(this.__sendEnd,this),a instanceof z&&this instanceof z&&a.hasCached()&&this.__handle(a.getCached())},__handle:function(a){this._send(a)},__onFirstIn:function(){this.__source.onChanges(this.__handle,this)},__onLastOut:function(){this.__source.off(this.__handle,this)},__end:function(){this.__source=null}};t.PropertyFromStream=function(a,b){o(a),z.call(this,null,null,b),this.__Constructor.call(this,a)},g(t.PropertyFromStream,z,B,{__ClassName:"PropertyFromStream",__objName:"stream.toProperty()",__end:function(){z.prototype.__end.call(this),B.__end.call(this)}}),y.prototype.toProperty=function(a){return new t.PropertyFromStream(this,a)},t.ChangesStream=function(a){p(a),y.call(this),this.__Constructor.call(this,a)},g(t.ChangesStream,y,B,{__ClassName:"ChangesStream",__objName:"property.changes()",__end:function(){y.prototype.__end.call(this),B.__end.call(this)}}),z.prototype.changes=function(){return new t.ChangesStream(this)};var C={__Constructor:function(a,b){a instanceof z?z.call(this):y.call(this),this.__mapFn=b,B.__Constructor.call(this,a)},__handle:function(a){this._send(this.__mapFn(a))},__end:function(){y.prototype.__end.call(this),B.__end.call(this),this.__mapFn=null}};h(C,B),t.MappedStream=function(){this.__Constructor.apply(this,arguments)},g(t.MappedStream,y,C,{__ClassName:"MappedStream"}),t.MappedProperty=function(){this.__Constructor.apply(this,arguments)},g(t.MappedProperty,z,C,{__ClassName:"MappedProperty"}),x.prototype.map=function(a){return this instanceof z?new t.MappedProperty(this,a):new t.MappedStream(this,a)};var D={__handle:function(a){this.__mapFn(a)&&this._send(a)}};h(D,C),t.FilteredStream=function(){this.__Constructor.apply(this,arguments)},g(t.FilteredStream,y,D,{__ClassName:"FilteredStream"}),t.FilteredProperty=function(){this.__Constructor.apply(this,arguments)},g(t.FilteredProperty,z,D,{__ClassName:"FilteredProperty"}),x.prototype.filter=function(a){return this instanceof z?new t.FilteredProperty(this,a):new t.FilteredStream(this,a)};var E={__handle:function(a){this._send(this.__mapFn(a)?a:t.END)}};h(E,C),t.TakeWhileStream=function(){this.__Constructor.apply(this,arguments)},g(t.TakeWhileStream,y,E,{__ClassName:"TakeWhileStream"}),t.TakeWhileProperty=function(){this.__Constructor.apply(this,arguments)},g(t.TakeWhileProperty,z,E,{__ClassName:"TakeWhileStream"}),x.prototype.takeWhile=function(a){return this instanceof z?new t.TakeWhileProperty(this,a):new t.TakeWhileStream(this,a)},x.prototype.take=function(a){return r("observable.take(n)",this.takeWhile(function(){return a-->0}))},t.Bus=function(){y.call(this),this.__plugged=[]},g(t.Bus,y,{__ClassName:"Bus",__objName:"Kefir.bus()",push:function(a){this._send(a)},plug:function(a){this.isEnded()||(this.__plugged.push(a),this.hasSubscribers()&&a.on(this._send,this),a.onEnd(this.unplug,this,a))},unplug:function(a){this.isEnded()||(a.off(this._send,this),i(this.__plugged,a))},end:function(){this._send(t.END)},__onFirstIn:function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].on(this._send,this)},__onLastOut:function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].off(this._send,this)},__end:function(){y.prototype.__end.call(this),this.__plugged=null,this.push=b}}),t.bus=function(){return new t.Bus},t.FlatMappedStream=function(a,b){y.call(this),this.__sourceStream=a,this.__plugged=[],this.__mapFn=b,a.onEnd(this.__sendEnd,this)},g(t.FlatMappedStream,y,{__ClassName:"FlatMappedStream",__objName:"observable.flatMap(fn)",__plugResult:function(a){this.__plug(this.__mapFn(a))},__onFirstIn:function(){this.__sourceStream.on(this.__plugResult,this);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].on(this._send,this)},__onLastOut:function(){this.__sourceStream.off(this.__plugResult,this);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].off(this._send,this)},__plug:function(a){this.__plugged.push(a),this.hasSubscribers()&&a.on(this._send,this),a.onEnd(this.__unplug,this,a)},__unplug:function(a){this.isEnded()||(a.off(this._send,this),i(this.__plugged,a))},__end:function(){y.prototype.__end.call(this),this.__sourceStream=null,this.__mapFn=null,this.__plugged=null}}),x.prototype.flatMap=function(a){return new t.FlatMappedStream(this,a)},t.MergedStream=function(){y.call(this),this.__sources=k(arguments);for(var a=0;a<this.__sources.length;a++)this.__sources[a].onEnd(this.__unplug,this,this.__sources[a])},g(t.MergedStream,y,{__ClassName:"MergedStream",__objName:"Kefir.merge(streams)",__onFirstIn:function(){for(var a=0;a<this.__sources.length;a++)this.__sources[a].onChanges(this._send,this)},__onLastOut:function(){for(var a=0;a<this.__sources.length;a++)this.__sources[a].off(this._send,this)},__unplug:function(a){a.off(this._send,this),i(this.__sources,a),0===this.__sources.length&&this._send(t.END)},__end:function(){y.prototype.__end.call(this),this.__sources=null}}),t.merge=function(){return new t.MergedStream(k(arguments))},y.prototype.merge=function(){return t.merge([this].concat(k(arguments)))},t.CombinedStream=function(a,b){y.call(this),this.__sources=a,this.__cachedValues=new Array(a.length),this.__hasCached=new Array(a.length),this.__mapFn=b;for(var c=0;c<this.__sources.length;c++)this.__sources[c].onEnd(this.__unplug,this,c)},g(t.CombinedStream,y,{__ClassName:"CombinedStream",__objName:"Kefir.combine(streams, fn)",__onFirstIn:function(){for(var a=0;a<this.__sources.length;a++)this.__sources[a]&&this.__sources[a].on(this.__receive,this,a)},__onLastOut:function(){for(var a=0;a<this.__sources.length;a++)this.__sources[a]&&this.__sources[a].off(this.__receive,this,a)},__unplug:function(a){this.__sources[a].off(this.__receive,this,a),this.__sources[a]=null,j(this.__sources)&&this._send(t.END)},__receive:function(a,b){this.__hasCached[a]=!0,this.__cachedValues[a]=b,this.__allCached()&&this._send(q(this.__mapFn)?this.__mapFn.apply(null,this.__cachedValues):this.__cachedValues.slice(0))},__allCached:function(){for(var a=0;a<this.__hasCached.length;a++)if(!this.__hasCached[a])return!1;return!0},__end:function(){y.prototype.__end.call(this),this.__sources=null,this.__cachedValues=null,this.__hasCached=null,this.__mapFn=null}}),t.combine=function(a,b){return new t.CombinedStream(a,b)},x.prototype.combine=function(a,b){return t.combine([this].concat(a),b)};var F=t.FromPollStream=function(a,b){y.call(this),this.__interval=a,this.__intervalId=null;var c=this;this.__send=function(){c._send(b())}};g(F,y,{__ClassName:"FromPollStream",__objName:"Kefir.fromPoll(interval, fn)",__onFirstIn:function(){this.__intervalId=setInterval(this.__send,this.__interval)},__onLastOut:function(){null!==this.__intervalId&&(clearInterval(this.__intervalId),this.__intervalId=null)},__end:function(){y.prototype.__end.call(this),this.__send=null}}),t.fromPoll=function(a,b){return r("Kefir.fromPoll(interval, fn)",new F(a,b))},t.interval=function(a,b){return r("Kefir.interval(interval, x)",new F(a,function(){return b}))},t.sequentially=function(a,b){return b=b.slice(0),r("Kefir.sequentially(interval, xs)",new F(a,function(){return 0===b.length?u:1===b.length?t.bunch(b[0],u):b.shift()}))},t.repeatedly=function(a,b){var c=-1;return r("Kefir.repeatedly(interval, xs)",new F(a,function(){return b[++c%b.length]}))},"function"==typeof define&&define.amd?(define([],function(){return t}),a.Kefir=t):"object"==typeof module&&"object"==typeof exports?(module.exports=t,t.Kefir=t):a.Kefir=t}(this);