/*! kefir - 0.1.12
 *  https://github.com/pozadi/kefir
 */

!function(a){"use strict";function b(a){return a}function c(a,b,c){return a&&b in a?a[b]:c}function d(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function e(a){var b=function(){};return b.prototype=a,new b}function f(){var a,b,c,e=arguments.length;if(1===e)return arguments[0];for(a=arguments[0],b=1;e>b;b++)for(c in arguments[b])d(arguments[b],c)&&(a[c]=arguments[b][c]);return a}function g(a,b){var c,d=arguments.length;for(a.prototype=e(b.prototype),a.prototype.constructor=a,c=2;d>c;c++)f(a.prototype,arguments[c]);return a}function h(a){return 1===a.length&&p(a[0])?a[0]:n(a)}function i(a,b){if(o(a))return a;if(null!=b&&o(b[a]))return b[a];throw new Error("not a function: "+a+" in "+b)}function j(a,b,c){if(null!=b)return c&&0!==c.length?a.apply(b,c):a.call(b);if(!c||0===c.length)return a();switch(c.length){case 1:return a(c[0]);case 2:return a(c[0],c[1]);case 3:return a(c[0],c[1],c[2])}return a.apply(null,c)}function k(a,b){var c,d,e=new Array(a.length+b.length),f=0;for(c=a.length,d=0;c>d;d++,f++)e[f]=a[d];for(c=b.length,d=0;c>d;d++,f++)e[f]=b[d];return e}function l(a){var b,c=a.length,d=new Array(c);for(b=0;c>b;b++)d[b]=a[b];return d}function m(a,b,c){return a.length>b?Array.prototype.slice.call(a,b):c}function n(a){return p(a)?a:l(a)}function o(a){return"function"==typeof a}function p(a){return"[object Array]"===Object.prototype.toString.call(a)}function q(a,b){var c,d;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;if(a.length!==b.length)return!1;for(d=0,c=a.length;c>d;d++)if(a[d]!==b[d])return!1;return!0}function r(a,b){function c(a,b){y.call(this),this._wait=a,this._intervalId=null;var c=this;this._bindedOnTick=function(){c._onTick()},this._init(b)}g(c,y,{_name:a,_init:function(){},_free:function(){},_onTick:function(){},_onActivation:function(){this._intervalId=setInterval(this._bindedOnTick,this._wait)},_onDeactivation:function(){null!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)},_clear:function(){y.prototype._clear.call(this),this._bindedOnTick=null,this._free()}},b),I[a]=function(a){return new c(a,m(arguments,1,[]))}}function s(a){for(var b=new Array(a.length),c=0;c<a.length;c++){if(!a[c].has("value"))return null;b[c]=a[c].get("value")}return b}function t(a,b,c){function d(a){y.call(this),this._multSubscriber=new u([this._handleAny,this]),this._init(a)}return g(d,y,{_name:a,_init:function(){},_free:function(){},_onActivationHook:function(){},_onPreActivationHook:function(){},_onDeactivationHook:function(){},_handleValue:function(a){this._send("value",a)},_handleError:function(a){this._send("error",a)},_handleEnd:function(){},_handleAny:function(a,b,c){switch(a){case"value":this._handleValue(b,c);break;case"error":this._handleError(b,c);break;case"end":this._handleEnd(b,c)}},_onActivation:function(){this._onPreActivationHook(),this._multSubscriber.start(),this._onActivationHook()},_onDeactivation:function(){this._multSubscriber.stop(),this._onDeactivationHook()},_clear:function(){y.prototype._clear.call(this),this._multSubscriber.clear(),this._multSubscriber=null,this._free()}},b),c||(I[a]=function(){return new d(arguments)}),d}function u(a){this.listener=new w(a),this.properties=[],this.active=!1}function v(a,b){function c(a,b){y.call(this),this._source=a,this._init(b)}g(c,y,{_name:a,_init:function(){},_free:function(){},_handleValue:function(a){this._send("value",a)},_handleError:function(a){this._send("error",a)},_handleEnd:function(a){this._send("end",a)},_onActivationHook:function(){},_onDeactivationHook:function(){},_handleAny:function(a,b,c){switch(a){case"value":this._handleValue(b,c);break;case"error":this._handleError(b,c);break;case"end":this._handleEnd(b,c)}},_onActivation:function(){this._source.watch("any",[this._handleAny,this]),this._onActivationHook()},_onDeactivation:function(){this._source.off("any",[this._handleAny,this]),this._onDeactivationHook()},_clear:function(){y.prototype._clear.call(this),this._source=null,this._free()}},b),y.prototype[a]=function(){return new c(this,arguments)}}function w(a){if(o(a)||a instanceof w)return a;if(!a||!a.length)throw new Error("can't convert to Fn "+a);if(1===a.length){if(o(a[0]))return a[0];throw new Error("can't convert to Fn "+a)}this.fn=i(a[0],a[1]),this.context=a[1],this.args=m(a,2,null)}function x(){this.value=[],this.error=[],this.end=[],this.any=[],this.total=0}function y(){this._subscribers=new x,this._active=!1,this._current={value:F,error:F,end:F}}function z(){J.apply(this,arguments)}function A(a,b){return a===b}function B(a){y.call(this),this._fn=new w(a)}function C(){y.call(this)}function D(a){y.call(this),this._send("value",a),this._send("end")}function E(a){y.call(this),this._send("error",a),this._send("end")}var F=["<nothing>"],G=Date.now?function(){return Date.now()}:function(){return(new Date).getTime()},H=function(a){return"[object Arguments]"===Object.prototype.toString.call(a)};H(arguments)||(H=function(a){return!(!a||!d(a,"callee"))}),f(u.prototype,{start:function(){if(!this.active&&(this.active=!0,this.hasProperties()))for(var a=l(this.properties),b=0;b<a.length;b++)this.subToProp(a[b])},stop:function(){if(this.active){this.active=!1;for(var a=0;a<this.properties.length;a++)this.unsubFromProp(this.properties[a])}},subToProp:function(a){this.active&&(a.watch("any",this.listener),a.watch("end",[this.remove,this,a]))},unsubFromProp:function(a){a.off("any",this.listener),a.off("end",[this.remove,this,a])},addAll:function(a){for(var b=0;b<a.length;b++)this.add(a[b])},add:function(a){this.properties.push(a),this.subToProp(a)},remove:function(a){for(var b=0;b<this.properties.length;b++)if(this.properties[b]===a){this.properties.splice(b,1),this.unsubFromProp(a);break}0===this.properties.length&&this.onLastRemovedCb&&w.call(this.onLastRemovedCb)},removeAll:function(){if(this.hasProperties()){for(var a=0;a<this.properties.length;a++)this.unsubFromProp(this.properties[a]);this.properties=[],this.onLastRemovedCb&&w.call(this.onLastRemovedCb)}},onLastRemoved:function(a){this.onLastRemovedCb=new w(a),this.hasProperties()||w.call(this.onLastRemovedCb)},offLastRemoved:function(){this.onLastRemovedCb=null},hasProperties:function(){return this.properties.length>0},clear:function(){this.active=!1,this.offLastRemoved(),this.removeAll()}});var I={};I.Fn=w,w.call=function(a,b){return o(a)?j(a,null,b):a instanceof w?(a.args&&(b=b?k(a.args,b):a.args),j(a.fn,a.context,b)):w.call(new w(a),b)},w.isEqual=function(a,b){return a===b?!0:(a=new w(a),b=new w(b),o(a)||o(b)?a===b:a.fn===b.fn&&a.context===b.context&&q(a.args,b.args))},f(x.prototype,{add:function(a,b){this[a].push(new w(b)),this.total++},remove:function(a,b){var c,d=new w(b),e=this[a],f=e.length;for(c=0;f>c;c++)if(w.isEqual(e[c],d))return e.splice(c,1),void this.total--},call:function(a,b){var c,d=this[a],e=d.length;if(0!==e)if(1===e)w.call(d[0],b);else for(d=l(d),c=0;e>c;c++)w.call(d[c],b)},isEmpty:function(){return 0===this.total}}),I.Property=y,f(y.prototype,{_name:"property",_onActivation:function(){},_onDeactivation:function(){},_setActive:function(a){this._active!==a&&(this._active=a,a?this._onActivation():this._onDeactivation())},_clear:function(){this._setActive(!1),this._subscribers=null},_send:function(a,b){this.has("end")||(this._current[a]=b,this._subscribers.call(a,[b,!1]),this._subscribers.call("any",[a,b,!1]),"end"===a&&this._clear())},on:function(a,b){return this.has("end")||(this._setActive(!0),this.has("end")||this._subscribers.add(a,b)),this},off:function(a,b){return this.has("end")||(this._subscribers.remove(a,b),this._subscribers.isEmpty()&&this._setActive(!1)),this},watch:function(a,b){return this.on(a,b),"any"===a?(this.has("value")&&w.call(b,["value",this.get("value"),!0]),this.has("error")&&w.call(b,["error",this.get("error"),!0]),this.has("end")&&w.call(b,["end",this.get("end"),!0])):this.has(a)&&w.call(b,[this.get(a),!0]),this},has:function(a){return("end"===a||"value"===a||"error"===a)&&this._current[a]!==F},get:function(a,b){return this.has(a)?this._current[a]:b},isActive:function(){return this._active},toString:function(){return"["+this._name+"]"}}),y.prototype.log=function(a){return null==a&&(a=this.toString()),this.watch("any",function(b,c,d){console.log(a,"<"+b+(d?":current":"")+">",c)}),this},r("withInterval",{_init:function(a){this._fn=new w(a[0]);var b=this;this._bindedSend=function(a,c){b._send(a,c)}},_free:function(){this._fn=null,this._bindedSend=null},_onTick:function(){w.call(this._fn,[this._bindedSend])}}),r("fromPoll",{_init:function(a){this._fn=new w(a[0])},_free:function(){this._fn=null},_onTick:function(){this._send("value",w.call(this._fn))}}),r("interval",{_init:function(a){this._x=a[0]},_free:function(){this._x=null},_onTick:function(){this._send("value",this._x)}}),r("sequentially",{_init:function(a){this._xs=l(a[0]),0===this._xs.length&&this._send("end")},_free:function(){this._xs=null},_onTick:function(){switch(this._xs.length){case 0:this._send("end");break;case 1:this._send("value",this._xs[0]),this._send("end");break;default:this._send("value",this._xs.shift())}}}),r("repeatedly",{_init:function(a){this._xs=l(a[0]),this._i=-1},_onTick:function(){this._xs.length>0&&(this._i=(this._i+1)%this._xs.length,this._send("value",this._xs[this._i]))}}),r("later",{_init:function(a){this._x=a[0]},_free:function(){this._x=null},_onTick:function(){this._send("value",this._x),this._send("end")}}),t("merge",{_init:function(a){var b=h(a);b.length>0?(this._multSubscriber.addAll(b),this._multSubscriber.onLastRemoved([this._send,this,"end"])):this._send("end")}}),y.prototype.merge=function(a){return I.merge([this,a])},t("combine",{_init:function(a){this._sources=a[0],this._fn=a[1]?new w(a[1]):null,this._sources.length>0?(this._multSubscriber.addAll(this._sources),this._multSubscriber.onLastRemoved([this._send,this,"end"])):this._send("end")},_free:function(){this._sources=null,this._fn=null},_handleValue:function(){var a=s(this._sources);null!==a&&this._send("value",this._fn?w.call(this._fn,a):a)}}),y.prototype.combine=function(a,b){return I.combine([this,a],b)};var J=t("flatMap",{_init:function(a){this._source=a[0],this._fn=a[1]?new w(a[1]):null},_free:function(){this._source=null,this._fn=null},_onActivationHook:function(){this._source.watch("any",[this._onAny,this]),this.has("end")||this._multSubscriber.onLastRemoved([this._endIfSourceEnded,this])},_onDeactivationHook:function(){this._source.off("any",[this._onAny,this]),this._multSubscriber.offLastRemoved()},_onValue:function(a){this._multSubscriber.add(this._fn?w.call(this._fn,[a]):a)},_onError:function(a){this._send("error",a)},_onAny:function(a,b){switch(a){case"value":this._onValue(b);break;case"error":this._onError(b);break;case"end":this._endIfNoSubSources()}},_endIfSourceEnded:function(){this._source.has("end")&&this._send("end")},_endIfNoSubSources:function(){this._multSubscriber.hasProperties()||this._send("end")}},!1);y.prototype.flatMap=function(a){return new J([this,a])},g(z,J,{_name:"flatMapLatest",_onValue:function(a){this._multSubscriber.removeAll(),J.prototype._onValue.call(this,a)}}),y.prototype.flatMapLatest=function(a){return new z([this,a])},t("pool",{add:function(a){this._multSubscriber.add(a)},remove:function(a){this._multSubscriber.remove(a)}}),t("sampledBy",{_init:function(a){var b=a[0],c=a[1];this._allSources=k(b,c),this._sourcesSubscriber=new u([this._passErrors,this]),this._sourcesSubscriber.addAll(b),this._fn=a[2]?new w(a[2]):null,c.length>0?(this._multSubscriber.addAll(c),this._multSubscriber.onLastRemoved([this._send,this,"end"])):(this._sourcesSubscriber.start(),this._send("end"))},_passErrors:function(a,b){"error"===a&&this._send(a,b)},_free:function(){this._allSources=null,this._sourcesSubscriber.clear(),this._sourcesSubscriber=null,this._fn=null},_handleValue:function(){var a=s(this._allSources);null!==a&&this._send("value",this._fn?w.call(this._fn,a):a)},_onPreActivationHook:function(){this._sourcesSubscriber.start()},_onDeactivationHook:function(){this._sourcesSubscriber.stop()}}),y.prototype.sampledBy=function(a,c){return I.sampledBy([this],[a],c||b)},v("withHandler",{_init:function(a){var b=this;this._handler=new w(a[0]),this._bindedSend=function(a,c){b._send(a,c)}},_free:function(){this._handler=null,this._bindedSend=null},_handleAny:function(a,b,c){w.call(this._handler,[this._bindedSend,a,b,c])}}),v("skipCurrent",{_init:function(a){this._type=a[0]},_handleValue:function(a,b){(!b||"value"!==this._type&&null!=this._type)&&this._send("value",a)},_handleError:function(a,b){(!b||"error"!==this._type&&null!=this._type)&&this._send("error",a)}}),v("addCurrent",{_init:function(a){this._type=a[0],this._x=a[1]},_onActivationHook:function(){this._send(this._type,this._x)}}),v("map",{_init:function(a){this._fn=new w(a[0])},_free:function(){this._fn=null},_handleValue:function(a){this._send("value",w.call(this._fn,[a]))}}),v("filter",{_init:function(a){this._fn=new w(a[0])},_free:function(){this._fn=null},_handleValue:function(a){w.call(this._fn,[a])&&this._send("value",a)}}),v("diff",{_init:function(a){this._prev=a[0],this._fn=new w(m(a,1))},_free:function(){this._prev=null,this._fn=null},_handleValue:function(a){this._send("value",w.call(this._fn,[this._prev,a])),this._prev=a}}),v("takeWhile",{_init:function(a){this._fn=new w(a[0])},_free:function(){this._fn=null},_handleValue:function(a){w.call(this._fn,[a])?this._send("value",a):this._send("end")}}),v("take",{_init:function(a){this._n=a[0],this._n<=0&&this._send("end")},_handleValue:function(a){this._n--,this._send("value",a),0===this._n&&this._send("end")}}),v("skip",{_init:function(a){this._n=a[0]},_handleValue:function(a){this._n<=0?this._send("value",a):this._n--}}),v("skipDuplicates",{_init:function(a){this._fn=a.length>0?new w(a[0]):A,this._prev=F},_free:function(){this._fn=null,this._prev=null},_handleValue:function(a){this._prev!==F&&w.call(this._fn,[this._prev,a])||this._send("value",a),this._prev=a}}),v("skipWhile",{_init:function(a){this._fn=new w(a[0]),this._skip=!0},_free:function(){this._fn=null},_handleValue:function(a){return this._skip?void(w.call(this._fn,[a])||(this._skip=!1,this._fn=null,this._send("value",a))):void this._send("value",a)}}),v("scan",{_init:function(a){this._send("value",a[0]),this._fn=new w(m(a,1))},_free:function(){this._fn=null},_handleValue:function(a){this._send("value",w.call(this._fn,[this.get("value"),a]))}}),v("reduce",{_init:function(a){this._result=a[0],this._fn=new w(m(a,1))},_free:function(){this._fn=null,this._result=null},_handleValue:function(a){this._result=w.call(this._fn,[this._result,a])},_handleEnd:function(){this._send("value",this._result),this._send("end")}}),v("throttle",{_init:function(a){this._wait=a[0],this._leading=c(a[1],"leading",!0),this._trailing=c(a[1],"trailing",!0),this._trailingCallValue=null,this._trailingCallTimeoutId=null,this._endAfterTrailingCall=!1,this._lastCallTime=0;var b=this;this._makeTrailingCallBinded=function(){b._makeTrailingCall()}},_free:function(){this._trailingCallValue=null,this._makeTrailingCallBinded=null},_handleValue:function(a,b){if(b)return void this._send("value",a);var c=G();0!==this._lastCallTime||this._leading||(this._lastCallTime=c);var d=this._wait-(c-this._lastCallTime);0>=d?(this._cancelTralingCall(),this._lastCallTime=c,this._send("value",a)):this._trailing&&this._scheduleTralingCall(a,d)},_handleEnd:function(){this._trailingCallTimeoutId?this._endAfterTrailingCall=!0:this._send("end")},_scheduleTralingCall:function(a,b){this._trailingCallTimeoutId&&this._cancelTralingCall(),this._trailingCallValue=a,this._trailingCallTimeoutId=setTimeout(this._makeTrailingCallBinded,b)},_cancelTralingCall:function(){null!==this._trailingCallTimeoutId&&(clearTimeout(this._trailingCallTimeoutId),this._trailingCallTimeoutId=null)},_makeTrailingCall:function(){this._send("value",this._trailingCallValue),this._trailingCallTimeoutId=null,this._trailingCallValue=null,this._lastCallTime=this._leading?G():0,this._endAfterTrailingCall&&this._send("end")}}),v("delay",{_init:function(a){this._wait=a[0]},_handleValue:function(a,b){if(b)return void this._send("value",a);var c=this;setTimeout(function(){c._send("value",a)},this._wait)},_handleEnd:function(){var a=this;setTimeout(function(){a._send("end")},this._wait)}}),g(B,y,{_name:"fromBinder",_onActivation:function(){var a=this;this._unsubscribe=w.call(this._fn,[function(b,c){a._send(b,c)}])},_onDeactivation:function(){o(this._unsubscribe)&&this._unsubscribe(),this._unsubscribe=null},_clear:function(){y.prototype._clear.call(this),this._fn=null}}),I.fromBinder=function(a){return new B(a)},g(C,y,{_name:"emitter",emit:function(a,b){this._send(a,b)}}),I.emitter=function(){return new C};var K=new y;K._send("end"),K._name="empty",I.empty=function(){return K},g(D,y,{_name:"constant"}),I.constant=function(a){return new D(a)},g(E,y,{_name:"constantError"}),I.constantError=function(a){return new E(a)},"function"==typeof define&&define.amd?(define([],function(){return I}),a.Kefir=I):"object"==typeof module&&"object"==typeof exports?(module.exports=I,I.Kefir=I):a.Kefir=I}(this);
//# sourceMappingURL=kefir.min.js.map