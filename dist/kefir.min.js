/*! kefir - 0.1.2
 *  https://github.com/pozadi/kefir
 */
!function(a){"use strict";function b(){}function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function d(a){return Array.prototype.slice.call(a)}function e(a){var b=function(){};return b.prototype=a,new b}function f(){var a=d(arguments);if(1===a.length)return a[0];for(var b=a.shift(),e=0;e<a.length;e++)for(var f in a[e])c(a[e],f)&&(b[f]=a[e][f]);return b}function g(a,b,c){return a.prototype=e(b.prototype),a.prototype.constructor=a,c&&f(a.prototype,c),a}function h(a,b){for(var c=0;c<a.length;)a[c]===b?a.splice(c,1):c++}function i(a){for(var b=0;b<a.length;b++)if(a[b])return!1;return!0}function j(a){return"[object Array]"===Object.prototype.toString.call(a[0])?a[0]:d(a)}function k(a,b){if(!a)throw new Error(b)}var l={};l.END=["<end>"],l.NO_MORE=["<no more>"];var m=l.Callbacks=g(function(){this.__subscribers=null,this.__contexts=null},Object,{add:function(a,b){null===this.__subscribers&&(this.__subscribers=[],this.__contexts=[]),this.__subscribers.push(a),this.__contexts.push(b)},remove:function(a,b){if(!this.isEmpty()){for(var c=0;c<this.__subscribers.length;c++)this.__subscribers[c]===a&&this.__contexts[c]===b&&(this.__subscribers[c]=null,this.__contexts[c]=null);i(this.__subscribers)&&(this.__subscribers=null,this.__contexts=null)}},isEmpty:function(){return null===this.__subscribers},hasOne:function(){return!this.isEmpty()&&1===this.__subscribers.length},send:function(a){if(!this.isEmpty())for(var b=0,c=this.__subscribers.length;c>b;b++){var d=this.__subscribers[b],e=this.__contexts[b];"function"==typeof d&&l.NO_MORE===d.call(e,a)&&this.remove(d,e)}}}),n=l.Stream=g(function(a,b){"function"==typeof a&&(this.__onFirstIn=a),"function"==typeof a&&(this.__onLastOut=b),this.__subscribers=new m,this.__endSubscribers=new m},Object,{_send:function(a){this.isEnded()||(a===l.END?this.__end():this.__deliver(a))},__deliver:function(a){this.__subscribers.isEmpty()||(this.__subscribers.send(a),this.__subscribers.isEmpty()&&this.__onLastOut())},on:function(a,b){this.isEnded()||(this.__subscribers.add(a,b),this.__subscribers.hasOne()&&this.__onFirstIn())},off:function(a,b){this.isEnded()||(this.__subscribers.remove(a,b),this.__subscribers.isEmpty()&&this.__onLastOut())},onEnd:function(a,b){this.isEnded()?a.call(b):this.__endSubscribers.add(a,b)},offEnd:function(a,b){this.isEnded()||this.__endSubscribers.remove(a,b)},isEnded:function(){return null===this.__subscribers},hasSubscribers:function(){return!this.isEnded()&&!this.__subscribers.isEmpty()},__onFirstIn:b,__onLastOut:b,__sendEnd:function(){this._send(l.END)},__end:function(){this.isEnded()||(this.__onLastOut(),this.__endSubscribers.send(),c(this,"__onFirstIn")&&(this.__onFirstIn=null),c(this,"__onLastOut")&&(this.__onLastOut=null),this.__subscribers=null,this.__endSubscribers=null)},onChanges:function(a,b){this.on(a,b)}}),o=e(n.prototype);o.__subscribers=null,l.never=function(){return o};var p=l.OnceStream=g(function(a){n.call(this),this.__value=a},n,{__onFirstIn:function(){this._send(this.__value),this.__value=null,this._send(l.END)}});l.once=function(a){return new p(a)};var q=l.Property=g(function(a,b,c){n.call(this,a,b),this.__hasCached="undefined"!=typeof c,this.__cached=c},n,{onChanges:function(a,b){n.prototype.on.call(this,a,b)},on:function(a,b){this.__hasCached&&a(this.__cached),this.onChanges(a,b)},_send:function(a){this.isEnded()||(this.__hasCached=!0,this.__cached=a),n.prototype._send.call(this,a)},toProperty:function(a){return k("undefined"==typeof a,"can't convert Property to Property with new initial value"),this},hasCached:function(){return this.__hasCached},getCached:function(){return this.__cached}}),r=l.PropertyFromStream=g(function(a,b){q.call(this,null,null,b),this.__sourceStream=a,a.onEnd(this.__sendEnd,this)},q,{__onFirstIn:function(){this.__sourceStream.on(this._send,this)},__onLastOut:function(){this.__sourceStream.off(this._send,this)},__end:function(){n.prototype.__end.call(this),this.__sourceStream=null}});l.toProperty=function(a,b){return new r(a,b)},n.prototype.toProperty=function(a){return l.toProperty(this,a)};var s=l.PropertyChangesStream=g(function(a){n.call(this),this.__sourceProperty=a;var b=this;a.onEnd(function(){b._send(l.END)})},n,{__onFirstIn:function(){this.__sourceProperty.onChanges(this._send,this)},__onLastOut:function(){this.__sourceProperty.off(this._send,this)},__end:function(){n.prototype.__end.call(this),this.__sourceProperty=null}});l.changes=function(a){return new s(a)},q.prototype.changes=function(){return l.changes(this)};var t=l.FromBinderStream=g(function(a){n.call(this),this.__generator=a;var b=this;this.__send=function(a){b._send(a)}},n,{__onFirstIn:function(){this.__generatorUsubscriber=this.__generator(this.__send)},__onLastOut:function(){"function"==typeof this.__generatorUsubscriber&&this.__generatorUsubscriber(),this.__generatorUsubscriber=null},__end:function(){n.prototype.__end.call(this),this.__generator=null,this.__send=null}});l.fromBinder=function(a){return new t(a)};var u=(l.Bus=g(function(){n.call(this),this.__plugged=[]},n,{push:function(a){this._send(a)},plug:function(a){if(!this.isEnded()){this.__plugged.push(a),this.hasSubscribers()&&a.on(this._send,this);var b=this;a.onEnd(function(){b.unplug(a)})}},unplug:function(a){this.isEnded()||(a.off(this._send,this),h(this.__plugged,a))},end:function(){this._send(l.END)},__onFirstIn:function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].on(this._send,this)},__onLastOut:function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].off(this._send,this)},__end:function(){n.prototype.__end.call(this),this.__plugged=null,this.push=b}}),l.FromPollStream=g(function(a,b){n.call(this),this.__interval=a,this.__intervalId=null;var c=this;this.__send=function(){c._send(b())}},n,{__onFirstIn:function(){this.__intervalId=setInterval(this.__send,this.__interval)},__onLastOut:function(){null!==this.__intervalId&&(clearInterval(this.__intervalId),this.__intervalId=null)},__end:function(){n.prototype.__end.call(this),this.__send=null}}));l.fromPoll=function(a,b){return new u(a,b)},l.interval=function(a,b){return new u(a,function(){return b})},l.sequentially=function(a,b){return b=b.slice(0),new u(a,function(){return 0===b.length?l.END:b.shift()})},l.repeatedly=function(a,b){var c=-1;return new u(a,function(){return b[++c%b.length]})};var v={__Constructor:function(a){this.__source=a,a.onEnd(this.__sendEnd,this),a instanceof q&&(k(this instanceof q,"`this` should be a Property"),a.hasCached()&&this.__handle(a.getCached()))},__handle:b,__onFirstIn:function(){this.__source.onChanges(this.__handle,this)},__onLastOut:function(){this.__source.off(this.__handle,this)},__end:function(){this.__source=null}},w=f({},v,{__Constructor:function(a,b){a instanceof q?q.call(this):n.call(this),this.__mapFn=b,v.__Constructor.call(this,a)},__handle:function(a){this._send(this.__mapFn(a))},__end:function(){n.prototype.__end.call(this),v.__end.call(this),this.__mapFn=null}}),x=l.MappedStream=g(function(){this.__Constructor.apply(this,arguments)},n,w),y=l.MappedProperty=g(function(){this.__Constructor.apply(this,arguments)},q,w);l.map=function(a,b){return a instanceof q?new y(a,b):new x(a,b)},n.prototype.map=function(a){return l.map(this,a)};var z=f({},w,{__handle:function(a){this.__mapFn(a)&&this._send(a)}}),A=l.FilteredStream=g(function(){this.__Constructor.apply(this,arguments)},n,z),B=l.FilteredProperty=g(function(){this.__Constructor.apply(this,arguments)},q,z);l.filter=function(a,b){return a instanceof q?new B(a,b):new A(a,b)},n.prototype.filter=function(a){return l.filter(this,a)};var C=f({},w,{__handle:function(a){this._send(this.__mapFn(a)?a:l.END)}}),D=l.TakeWhileStream=g(function(){this.__Constructor.apply(this,arguments)},n,C),E=l.TakeWhileProperty=g(function(){this.__Constructor.apply(this,arguments)},q,C);l.takeWhile=function(a,b){return a instanceof q?new E(a,b):new D(a,b)},n.prototype.takeWhile=function(a){return l.takeWhile(this,a)},l.take=function(a,b){return a.takeWhile(function(){return b-->0})},n.prototype.take=function(a){return l.take(this,a)};var F=l.FlatMappedStream=g(function(a,b){n.call(this),this.__sourceStream=a,this.__plugged=[],this.__mapFn=b,a.onEnd(this.__sendEnd,this)},n,{__plugResult:function(a){this.__plug(this.__mapFn(a))},__onFirstIn:function(){this.__sourceStream.on(this.__plugResult,this);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].on(this._send,this)},__onLastOut:function(){this.__sourceStream.off(this.__plugResult,this);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].off(this._send,this)},__plug:function(a){this.__plugged.push(a),this.hasSubscribers()&&a.on(this._send,this);var b=this;a.onEnd(function(){b.__unplug(a)})},__unplug:function(a){this.isEnded()||(a.off(this._send,this),h(this.__plugged,a))},__end:function(){n.prototype.__end.call(this),this.__sourceStream=null,this.__mapFn=null,this.__plugged=null}});l.flatMap=function(a,b){return new F(a,b)},n.prototype.flatMap=function(a){return l.flatMap(this,a)};var G=l.MergedStream=g(function(){n.call(this),this.__sourceStreams=j(arguments);for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a].onEnd(this.__unplugFor(this.__sourceStreams[a]))},n,{__onFirstIn:function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a].on(this._send,this)},__onLastOut:function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a].off(this._send,this)},__unplug:function(a){a.off(this._send,this),h(this.__sourceStreams,a),0===this.__sourceStreams.length&&this._send(l.END)},__unplugFor:function(a){var b=this;return function(){b.__unplug(a)}},__end:function(){n.prototype.__end.call(this),this.__sourceStreams=null}});l.merge=function(){return new G(j(arguments))},n.prototype.merge=function(){return l.merge([this].concat(j(arguments)))};var H=l.CombinedStream=g(function(a,b){n.call(this),this.__sourceStreams=a,this.__cachedValues=new Array(a.length),this.__hasCached=new Array(a.length),this.__receiveFns=new Array(a.length),this.__mapFn=b;for(var c=0;c<this.__sourceStreams.length;c++)this.__receiveFns[c]=this.__receiveFor(c),this.__sourceStreams[c].onEnd(this.__unplugFor(c))},n,{__onFirstIn:function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a]&&this.__sourceStreams[a].on(this.__receiveFns[a])},__onLastOut:function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a]&&this.__sourceStreams[a].off(this.__receiveFns[a])},__unplug:function(a){this.__sourceStreams[a].off(this.__receiveFns[a]),this.__sourceStreams[a]=null,this.__receiveFns[a]=null,i(this.__sourceStreams)&&this._send(l.END)},__unplugFor:function(a){var b=this;return function(){b.__unplug(a)}},__receive:function(a,b){this.__hasCached[a]=!0,this.__cachedValues[a]=b,this.__allCached()&&this._send("function"==typeof this.__mapFn?this.__mapFn.apply(null,this.__cachedValues):this.__cachedValues.slice(0))},__receiveFor:function(a){var b=this;return function(c){b.__receive(a,c)}},__allCached:function(){for(var a=0;a<this.__hasCached.length;a++)if(!this.__hasCached[a])return!1;return!0},__end:function(){n.prototype.__end.call(this),this.__sourceStreams=null,this.__cachedValues=null,this.__hasCached=null,this.__receiveFns=null,this.__mapFn=null}});l.combine=function(a,b){return new H(a,b)},n.prototype.combine=function(a,b){return l.combine([this].concat(a),b)},n.prototype.log=function(a){function b(b){a?console.log(a,b):console.log(b)}this.on(b),this.onEnd(function(){b(l.END)})},"function"==typeof define&&define.amd?(define([],function(){return l}),a.Kefir=l):"object"==typeof module&&"object"==typeof exports?(module.exports=l,l.Kefir=l):a.Kefir=l}(this);