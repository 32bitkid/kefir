/*! Kefir - 0.1.0
 *  https://github.com/pozadi/kefir
 */
!function(){"use strict";function a(a){var b=function(){};return b.prototype=a,new b}function b(b,c){return b.prototype=a(c.prototype),b.prototype.constructor=b,b.prototype.__superConstructor=c,b.prototype.__superProto=c.prototype,b}function c(a,b){for(var c=0;c<a.length;)a[c]===b?a.splice(c,1):c++}function d(){}function e(a){return"[object Array]"===Object.prototype.toString.call(a[0])?a[0]:Array.prototype.slice.call(a)}var f={};f.END=["<end>"],f.Stream=function(a,b){"function"==typeof a&&(this.__onFirstSubscribed=a),"function"==typeof a&&(this.__onLastUsubscribed=b),this.__subscribers=[],this.__endSubscribers=[]},f.Stream.prototype._send=function(a){if(!this.isEnded())if(a===f.END)this.__end();else for(var b=0;b<this.__subscribers.length;b++)this.__subscribers[b](a)},f.Stream.prototype.subscribe=function(a){this.isEnded()||(0===this.__subscribers.length&&this.__onFirstSubscribed(),this.__subscribers.push(a))},f.Stream.prototype.unsubscribe=function(a){this.isEnded()||(c(this.__subscribers,a),0===this.__subscribers.length&&this.__onLastUsubscribed())},f.Stream.prototype.onEnd=function(a){this.isEnded()?a():this.__endSubscribers.push(a)},f.Stream.prototype.offEnd=function(a){this.isEnded()||c(this.__endSubscribers,a)},f.Stream.prototype.isEnded=function(){return null===this.__subscribers},f.Stream.prototype.hasSubscribers=function(){return!this.isEnded()&&this.__subscribers.length>0},f.Stream.prototype.__onFirstSubscribed=d,f.Stream.prototype.__onLastUsubscribed=d,f.Stream.prototype.__end=function(){if(!this.isEnded()){this.__onLastUsubscribed(),this.hasOwnProperty(this.__onFirstSubscribed)&&(this.__onFirstSubscribed=null),this.hasOwnProperty(this.__onLastUsubscribed)&&(this.__onLastUsubscribed=null),this.__subscribers=null;for(var a=0;a<this.__endSubscribers.length;a++)this.__endSubscribers[a]();this.__endSubscribers=null}},f.Property=b(function(a,b,c){this.__superConstructor(a,b),this.__hasCached="undefined"!=typeof c,this.__cached=c},f.Stream),f.Property.prototype.subscribe=function(a){this.__hasCached&&a(this.__cached),this.__superProto.subscribe.call(this,a)},f.Property.prototype._send=function(a){this.__hasCached=!0,this.isEnded()||(this.__cached=a),this.__superProto._send.call(this,a)},f.toProperty=function(a,b){var c=function(a){g._send(a)},d=function(){a.subscribe(c)},e=function(){a.unsubscribe(c)};a.onEnd(function(){g._send(f.END)});var g=new f.Property(d,e,b);return g},f.Stream.prototype.toProperty=function(a){return f.toProperty(this,a)},f.fromBinder=function(a){var b=null,c=function(a){g._send(a)},d=function(){b=a(c)},e=function(){"function"==typeof b&&b(),b=null},g=new f.Stream(d,e);return g},f.Bus=b(function(){this.__superConstructor(),this.__plugged=[];var a=this;this.push=function(b){a._send(b)}},f.Stream),f.Bus.prototype.plug=function(a){if(!this.isEnded()){this.__plugged.push(a),this.hasSubscribers()&&a.subscribe(this.push);var b=this;a.onEnd(function(){b.unplug(a)})}},f.Bus.prototype.unplug=function(a){this.isEnded()||(a.unsubscribe(this.push),c(this.__plugged,a))},f.Bus.prototype.end=function(){this._send(f.END)},f.Bus.prototype.__onFirstSubscribed=function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].subscribe(this.push)},f.Bus.prototype.__onLastUsubscribed=function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].unsubscribe(this.push)},f.Bus.prototype.__end=function(){this.__superProto.__end.call(this),this.__plugged=null,this.push=d},f.MappedStream=b(function(a,b){this.__superConstructor(),this.__sourceStream=a;var c=this;this.__deliver=function(a){c._send(b(a))},a.onEnd(function(){c._send(f.END)})},f.Stream),f.MappedStream.prototype.__onFirstSubscribed=function(){this.__sourceStream.subscribe(this.__deliver)},f.MappedStream.prototype.__onLastUsubscribed=function(){this.__sourceStream.unsubscribe(this.__deliver)},f.MappedStream.prototype.__end=function(){this.__superProto.__end.call(this),this.__sourceStream=null,this.__deliver=null},f.map=function(a,b){return new f.MappedStream(a,b)},f.Stream.prototype.map=function(a){return f.map(this,a)},f.FlatMappedStream=b(function(a,b){this.__superConstructor(),this.__sourceStream=a,this.__plugged=[];var c=this;this.__deliver=function(a){c._send(a)},this.__plugResult=function(a){c.__plug(b(a))},a.onEnd(function(){c._send(f.END)})},f.Stream),f.FlatMappedStream.prototype.__onFirstSubscribed=function(){this.__sourceStream.subscribe(this.__plugResult);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].subscribe(this.__deliver)},f.FlatMappedStream.prototype.__onLastUsubscribed=function(){this.__sourceStream.unsubscribe(this.__plugResult);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].unsubscribe(this.__deliver)},f.FlatMappedStream.prototype.__plug=function(a){this.__plugged.push(a),this.hasSubscribers()&&a.subscribe(this.__deliver);var b=this;a.onEnd(function(){b.__unplug(a)})},f.FlatMappedStream.prototype.__unplug=function(a){this.isEnded()||(a.unsubscribe(this.__deliver),c(this.__plugged,a))},f.FlatMappedStream.prototype.__end=function(){this.__superProto.__end.call(this),this.__sourceStream=null,this.__deliver=null,this.__plugResult=null,this.__plugged=null},f.flatMap=function(a,b){return new f.FlatMappedStream(a,b)},f.Stream.prototype.flatMap=function(a){return f.flatMap(this,a)},f.MergedStream=b(function(){this.__superConstructor(),this.__sourceStreams=e(arguments);var a=this;this.__deliver=function(b){a._send(b)};for(var b=0;b<this.__sourceStreams.length;b++)this.__sourceStreams[b].onEnd(this.__unplugFor(this.__sourceStreams[b]))},f.Stream),f.MergedStream.prototype.__onFirstSubscribed=function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a].subscribe(this.__deliver)},f.MergedStream.prototype.__onLastUsubscribed=function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a].unsubscribe(this.__deliver)},f.MergedStream.prototype.__unplug=function(a){a.unsubscribe(this.__deliver),c(this.__sourceStreams,a),0===this.__sourceStreams.length&&this._send(f.END)},f.MergedStream.prototype.__unplugFor=function(a){var b=this;return function(){b.__unplug(a)}},f.MergedStream.prototype.__end=function(){this.__superProto.__end.call(this),this.__sourceStreams=null,this.__deliver=null},f.merge=function(){return new f.MergedStream(e(arguments))},f.Stream.prototype.merge=function(){return f.merge([this].concat(e(arguments)))},f.Stream.prototype.log=function(a){this.subscribe(function(b){a?console.log(a,b):console.log(b)})},"function"==typeof define&&define.amd?(define([],function(){return f}),this.Kefir=f):"object"==typeof module&&"object"==typeof exports?(module.exports=f,f.Kefir=f):this.Kefir=f}();