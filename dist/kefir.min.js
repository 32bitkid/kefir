/*! kefir - 0.1.12
 *  https://github.com/pozadi/kefir
 */
!function(a){"use strict";function b(a){return a}function c(a,b,c){return a&&b in a?a[b]:c}function d(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function e(a){var b=function(){};return b.prototype=a,new b}function f(){var a,b,c,e=arguments.length;if(1===e)return arguments[0];for(a=arguments[0],b=1;e>b;b++)for(c in arguments[b])d(arguments[b],c)&&(a[c]=arguments[b][c]);return a}function g(a,b){var c,d=arguments.length;for(a.prototype=e(b.prototype),a.prototype.constructor=a,c=2;d>c;c++)f(a.prototype,arguments[c]);return a}function h(a){return 1===a.length&&p(a[0])?a[0]:n(a)}function i(a,b){if(o(a))return a;if(null!=b&&o(b[a]))return b[a];throw new Error("not a function: "+a+" in "+b)}function j(a,b,c){if(null!=b)return c&&0!==c.length?a.apply(b,c):a.call(b);if(!c||0===c.length)return a();switch(c.length){case 1:return a(c[0]);case 2:return a(c[0],c[1]);case 3:return a(c[0],c[1],c[2])}return a.apply(null,c)}function k(a,b){var c,d,e=new Array(a.length+b.length),f=0;for(c=a.length,d=0;c>d;d++,f++)e[f]=a[d];for(c=b.length,d=0;c>d;d++,f++)e[f]=b[d];return e}function l(a){var b,c=a.length,d=new Array(c);for(b=0;c>b;b++)d[b]=a[b];return d}function m(a,b,c){return a.length>b?Array.prototype.slice.call(a,b):c}function n(a){return p(a)?a:l(a)}function o(a){return"function"==typeof a}function p(a){return"[object Array]"===Object.prototype.toString.call(a)}function q(a,b){var c,d;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;if(a.length!==b.length)return!1;for(d=0,c=a.length;c>d;d++)if(a[d]!==b[d])return!1;return!0}function r(a){if(o(a)||a instanceof r)return a;if(!a||!a.length)throw new Error("can't convert to Fn "+a);if(1===a.length){if(o(a[0]))return a[0];throw new Error("can't convert to Fn "+a)}this.fn=i(a[0],a[1]),this.context=a[1],this.args=m(a,2,null)}function s(){this.value=[],this.error=[],this.both=[],this.end=[]}function t(){this.__subscribers=new s,this.__active=!1,this.__current={value:G,error:G,end:G}}function u(a){t.call(this),this.__fn=new r(a)}function v(){t.call(this)}function w(a){t.call(this),this.__send("value",a),this.__send("end")}function x(a){t.call(this),this.__send("error",a),this.__send("end")}function y(a,b){return a===b}function z(a,b){function c(a,b){t.call(this),this.__source=a,this.__init(b),this.has("end")||this.__source.on("end",[this.__handleEnd,this]),!this.has("end")&&this.__source.has("value")&&this.__handleValue(this.__source.get("value"),!0),!this.has("end")&&this.__source.has("error")&&this.__handleError(this.__source.get("error"),!0)}g(c,t,{__name:a,__init:function(){},__free:function(){},__handleValue:function(a){this.__send("value",a)},__handleError:function(a){this.__send("error",a)},__handleEnd:function(){this.__send("end")},__handleBoth:function(a,b){"value"===a?this.__handleValue(b):this.__handleError(b)},__onActivation:function(){this.__source.on("both",[this.__handleBoth,this])},__onDeactivation:function(){this.__source.off("both",[this.__handleBoth,this])},__clear:function(){t.prototype.__clear.call(this),this.__source=null,this.__free()}},b),t.prototype[a]=function(){return new c(this,arguments)}}function A(){L.apply(this,arguments)}function B(a){for(var b=0;b<a.length;b++)if(!a[b].has("value"))return!1;return!0}function C(a){for(var b=new Array(a.length),c=0;c<a.length;c++)b[c]=a[c].get("value");return b}function D(a,b,c){function d(a){t.call(this),this.__multSubscriber=new E([this.__handleBoth,this]),this.__init(a)}return g(d,t,{__name:a,__init:function(){},__free:function(){},__onActivationHook:function(){},__onDeactivationHook:function(){},__handleValue:function(a){this.__send("value",a)},__handleError:function(a){this.__send("error",a)},__handleBoth:function(a,b,c){"value"===a?this.__handleValue(b,c):this.__handleError(b,c)},__onActivation:function(){this.__multSubscriber.start(),this.__onActivationHook()},__onDeactivation:function(){this.__multSubscriber.stop(),this.__onDeactivationHook()},__clear:function(){t.prototype.__clear.call(this),this.__multSubscriber.clear(),this.__multSubscriber=null,this.__free()}},b),c||(J[a]=function(){return new d(arguments)}),d}function E(a){this.listener=new r(a),this.properties=[],this.active=!1}function F(a,b){function c(a,b){t.call(this),this.__wait=a,this.__intervalId=null;var c=this;this.__bindedOnTick=function(){c.__onTick()},this.__init(b)}g(c,t,{__name:a,__init:function(){},__free:function(){},__onTick:function(){},__onActivation:function(){this.__intervalId=setInterval(this.__bindedOnTick,this.__wait)},__onDeactivation:function(){null!==this.__intervalId&&(clearInterval(this.__intervalId),this.__intervalId=null)},__clear:function(){t.prototype.__clear.call(this),this.__bindedOnTick=null,this.__free()}},b),J[a]=function(a){return new c(a,m(arguments,1,[]))}}var G=["<nothing>"],H=Date.now?function(){return Date.now()}:function(){return(new Date).getTime()},I=function(a){return"[object Arguments]"===Object.prototype.toString.call(a)};I(arguments)||(I=function(a){return!(!a||!d(a,"callee"))});var J={};r.call=function(a,b){return o(a)?j(a,null,b):a instanceof r?(a.args&&(b=b?k(a.args,b):a.args),j(a.fn,a.context,b)):r.call(new r(a),b)},r.isEqual=function(a,b){return a===b?!0:(a=new r(a),b=new r(b),o(a)||o(b)?a===b:a.fn===b.fn&&a.context===b.context&&q(a.args,b.args))},f(s.prototype,{add:function(a,b){this[a].push(new r(b))},remove:function(a,b){var c,d=new r(b),e=this[a],f=e.length;for(c=0;f>c;c++)if(r.isEqual(e[c],d))return void e.splice(c,1)},call:function(a,b){var c,d=this[a],e=d.length;if(0!==e)if(1===e)r.call(d[0],b);else for(d=l(d),c=0;e>c;c++)r.call(d[c],b)},hasValueOrError:function(){return this.value.length>0||this.error.length>0||this.both.length>0}}),J.Property=t,f(t.prototype,{__name:"property",__onActivation:function(){},__onDeactivation:function(){},__setActive:function(a){this.__active!==a&&(this.__active=a,a?this.__onActivation():this.__onDeactivation())},__clear:function(){this.__setActive(!1),this.__subscribers=null},__send:function(a,b){this.has("end")||(this.__current[a]=b,this.__subscribers.call(a,[b]),"end"===a?this.__clear():this.__subscribers.call("both",[a,b]))},on:function(a,b){return this.has("end")||(this.__subscribers.add(a,b),"end"!==a&&this.__setActive(!0)),this},off:function(a,b){return this.has("end")||(this.__subscribers.remove(a,b),"end"===a||this.__subscribers.hasValueOrError()||this.__setActive(!1)),this},watch:function(a,b){return"both"===a?(this.has("value")&&r.call(b,["value",this.get("value"),!0]),this.has("error")&&r.call(b,["error",this.get("error"),!0])):this.has(a)&&r.call(b,[this.get(a),!0]),this.on(a,b)},has:function(a){return a in this.__current&&this.__current[a]!==G},get:function(a,b){return this.has(a)?this.__current[a]:b},isActive:function(){return this.__active},toString:function(){return"["+this.__name+"]"}}),t.prototype.log=function(a){return null==a&&(a=this.toString()),this.watch("both",function(b,c,d){console.log(a,"<"+b+(d?":current":"")+">",c)}),this.watch("end",function(b,c){console.log(a,"<end"+(c?":current":"")+">")}),this},g(u,t,{__name:"fromBinder",__onActivation:function(){var a=this;this.__unsubscribe=r.call(this.__fn,[function(b,c){a.__send(b,c)}])},__onDeactivation:function(){o(this.__unsubscribe)&&this.__unsubscribe(),this.__unsubscribe=null},__clear:function(){t.prototype.__clear.call(this),this.__fn=null}}),J.fromBinder=function(a){return new u(a)},g(v,t,{__name:"emitter",emit:function(a,b){this.__send(a,b)}}),J.emitter=function(){return new v};var K=new t;K.__send("end"),K.__name="empty",J.empty=function(){return K},g(w,t,{__name:"constant"}),J.constant=function(a){return new w(a)},g(x,t,{__name:"constantError"}),J.constantError=function(a){return new x(a)},z("withHandler",{__init:function(a){var b=this;this.__handler=new r(a[0]),this.__bindedSend=function(a,c){b.__send(a,c)}},__free:function(){this.__handler=null,this.__bindedSend=null},__handleValue:function(a,b){r.call(this.__handler,[this.__bindedSend,"value",a,b])},__handleError:function(a,b){r.call(this.__handler,[this.__bindedSend,"error",a,b])},__handleEnd:function(){r.call(this.__handler,[this.__bindedSend,"end"])}}),z("removeCurrent",{__init:function(a){this.__type=a[0]||"both"},__handleValue:function(a,b){(!b||"value"!==this.__type&&"both"!==this.__type)&&this.__send("value",a)},__handleError:function(a,b){(!b||"error"!==this.__type&&"both"!==this.__type)&&this.__send("error",a)}}),z("addCurrent",{__init:function(a){this.__type=a[0],this.__send(a[0],a[1])},__handleValue:function(a,b){b&&"value"===this.__type||this.__send("value",a)},__handleError:function(a,b){b&&"error"===this.__type||this.__send("error",a)}}),z("map",{__init:function(a){this.__fn=new r(a[0])},__free:function(){this.__fn=null},__handleValue:function(a){this.__send("value",r.call(this.__fn,[a]))}}),z("filter",{__init:function(a){this.__fn=new r(a[0])},__free:function(){this.__fn=null},__handleValue:function(a){r.call(this.__fn,[a])&&this.__send("value",a)}}),z("diff",{__init:function(a){this.__prev=a[0],this.__fn=new r(m(a,1))},__free:function(){this.__prev=null,this.__fn=null},__handleValue:function(a){this.__send("value",r.call(this.__fn,[this.__prev,a])),this.__prev=a}}),z("takeWhile",{__init:function(a){this.__fn=new r(a[0])},__free:function(){this.__fn=null},__handleValue:function(a){r.call(this.__fn,[a])?this.__send("value",a):this.__send("end")}}),z("take",{__init:function(a){this.__n=a[0],this.__n<=0&&this.__send("end")},__handleValue:function(a){this.__n--,this.__send("value",a),0===this.__n&&this.__send("end")}}),z("skip",{__init:function(a){this.__n=a[0]},__handleValue:function(a){this.__n<=0?this.__send("value",a):this.__n--}}),z("skipDuplicates",{__init:function(a){this.__fn=a.length>0?new r(a[0]):y,this.__prev=G},__free:function(){this.__fn=null,this.__prev=null},__handleValue:function(a){this.__prev!==G&&r.call(this.__fn,[this.__prev,a])||this.__send("value",a),this.__prev=a}}),z("skipWhile",{__init:function(a){this.__fn=new r(a[0]),this.__skip=!0},__free:function(){this.__fn=null},__handleValue:function(a){return this.__skip?void(r.call(this.__fn,[a])||(this.__skip=!1,this.__fn=null,this.__send("value",a))):void this.__send("value",a)}}),z("scan",{__init:function(a){this.__send("value",a[0]),this.__fn=new r(m(a,1))},__free:function(){this.__fn=null},__handleValue:function(a){this.__send("value",r.call(this.__fn,[this.get("value"),a]))}}),z("reduce",{__init:function(a){this.__result=a[0],this.__fn=new r(m(a,1))},__free:function(){this.__fn=null,this.__result=null},__handleValue:function(a){this.__result=r.call(this.__fn,[this.__result,a])},__handleEnd:function(){this.__send("value",this.__result),this.__send("end")}}),z("throttle",{__init:function(a){this.__wait=a[0],this.__leading=c(a[1],"leading",!0),this.__trailing=c(a[1],"trailing",!0),this.__trailingCallValue=null,this.__trailingCallTimeoutId=null,this.__endAfterTrailingCall=!1,this.__lastCallTime=0;var b=this;this.__makeTrailingCallBinded=function(){b.__makeTrailingCall()}},__free:function(){this.__trailingCallValue=null,this.__makeTrailingCallBinded=null},__handleValue:function(a,b){if(b)return void this.__send("value",a);var c=H();0!==this.__lastCallTime||this.__leading||(this.__lastCallTime=c);var d=this.__wait-(c-this.__lastCallTime);0>=d?(this.__cancelTralingCall(),this.__lastCallTime=c,this.__send("value",a)):this.__trailing&&this.__scheduleTralingCall(a,d)},__handleEnd:function(){this.__trailingCallTimeoutId?this.__endAfterTrailingCall=!0:this.__send("end")},__scheduleTralingCall:function(a,b){this.__trailingCallTimeoutId&&this.__cancelTralingCall(),this.__trailingCallValue=a,this.__trailingCallTimeoutId=setTimeout(this.__makeTrailingCallBinded,b)},__cancelTralingCall:function(){null!==this.__trailingCallTimeoutId&&(clearTimeout(this.__trailingCallTimeoutId),this.__trailingCallTimeoutId=null)},__makeTrailingCall:function(){this.__send("value",this.__trailingCallValue),this.__trailingCallTimeoutId=null,this.__trailingCallValue=null,this.__lastCallTime=this.__leading?H():0,this.__endAfterTrailingCall&&this.__send("end")}}),z("delay",{__init:function(a){this.__wait=a[0]},__handleValue:function(a,b){if(b)return void this.__send("value",a);var c=this;setTimeout(function(){c.__send("value",a)},this.__wait)},__handleEnd:function(){var a=this;setTimeout(function(){a.__send("end")},this.__wait)}}),D("merge",{__init:function(a){var b=h(a);b.length>0?(this.__multSubscriber.addAll(b),this.__multSubscriber.onLastRemoved([this.__send,this,"end"])):this.__send("end")}}),t.prototype.merge=function(a){return J.merge([this,a])},D("combine",{__init:function(a){this.__sources=a[0],this.__fn=a[1]?new r(a[1]):null,this.__sources.length>0?(this.__multSubscriber.addAll(this.__sources),this.__multSubscriber.onLastRemoved([this.__send,this,"end"])):this.__send("end")},__free:function(){this.__sources=null,this.__fn=null},__handleValue:function(){B(this.__sources)&&(this.__fn?this.__send("value",r.call(this.__fn,C(this.__sources))):this.__send("value",C(this.__sources)))}}),t.prototype.combine=function(a,b){return J.combine([this,a],b)};var L=D("flatMap",{__init:function(a){this.__source=a[0],this.__fn=a[1]?new r(a[1]):null,this.__multSubscriber.onLastRemoved([this.__endIfSourceEnded,this]),this.__source.on("end",[this.__endIfNoSubSources,this]),this.__source.has("value")&&this.__onValue(this.__source.get("value")),this.__source.has("error")&&this.__onError(this.__source.get("error"))},__free:function(){this.__source=null,this.__fn=null},__onActivationHook:function(){this.__source.on("both",[this.__onBoth,this])},__onDeactivationHook:function(){this.__source.off("both",[this.__onBoth,this])},__onValue:function(a){this.__multSubscriber.add(this.__fn?r.call(this.__fn,[a]):a)},__onError:function(a){this.__send("error",a)},__onBoth:function(a,b){"value"===a?this.__onValue(b):this.__onError(b)},__endIfSourceEnded:function(){this.__source.has("end")&&this.__send("end")},__endIfNoSubSources:function(){this.__multSubscriber.hasProperties()||this.__send("end")}},!1);t.prototype.flatMap=function(a){return new L([this,a])},g(A,L,{__name:"flatMapLatest",__onValue:function(a){this.__multSubscriber.removeAll(),L.prototype.__onValue.call(this,a)}}),t.prototype.flatMapLatest=function(a){return new A([this,a])},D("pool",{add:function(a){this.__multSubscriber.add(a)},remove:function(a){this.__multSubscriber.remove(a)}}),D("sampledBy",{__init:function(a){var b=a[0],c=a[1];this.__allSources=k(b,c),this.__sourcesSubscriber=new E([this.__passErrors,this]),this.__sourcesSubscriber.addAll(b),this.__fn=a[2]?new r(a[2]):null,c.length>0?(this.__multSubscriber.addAll(c),this.__multSubscriber.onLastRemoved([this.__send,this,"end"])):this.__send("end")},__passErrors:function(a,b){"error"===a&&this.__send(a,b)},__free:function(){this.__allSources=null,this.__sourcesSubscriber.clear(),this.__sourcesSubscriber=null,this.__fn=null},__handleValue:function(){B(this.__allSources)&&(this.__fn?this.__send("value",r.call(this.__fn,C(this.__allSources))):this.__send("value",C(this.__allSources)))},__onActivationHook:function(){this.__sourcesSubscriber.start()},__onDeactivationHook:function(){this.__sourcesSubscriber.stop()}}),t.prototype.sampledBy=function(a,c){return J.sampledBy([this],[a],c||b)},f(E.prototype,{start:function(){if(!this.active){for(var a=0;a<this.properties.length;a++)this.properties[a].on("both",this.listener);this.active=!0}},stop:function(){if(this.active){for(var a=0;a<this.properties.length;a++)this.properties[a].off("both",this.listener);this.active=!1}},addAll:function(a){for(var b=0;b<a.length;b++)this.add(a[b])},add:function(a){this.properties.push(a),a.on("end",[this.remove,this,a]),a.has("value")&&r.call(this.listener,["value",a.get("value"),!0]),a.has("error")&&r.call(this.listener,["error",a.get("error"),!0]),this.active&&a.on("both",this.listener)},remove:function(a){for(var b=0;b<this.properties.length;b++)if(this.properties[b]===a){this.properties.splice(b,1),a.off("end",[this.remove,this,a]),this.active&&a.off("both",this.listener);break}0===this.properties.length&&this.onLastRemovedCb&&r.call(this.onLastRemovedCb)},removeAll:function(){for(var a=0;a<this.properties.length;a++)this.properties[a].off("end",[this.remove,this,this.properties[a]]),this.active&&this.properties[a].off("both",this.listener);this.properties=[],this.onLastRemovedCb&&r.call(this.onLastRemovedCb)},onLastRemoved:function(a){this.onLastRemovedCb=new r(a)},offLastRemoved:function(){this.onLastRemovedCb=null},hasProperties:function(){return this.properties.length>0},clear:function(){this.offLastRemoved(),this.removeAll()}}),F("withInterval",{__init:function(a){this.__fn=new r(a[0]);var b=this;this.__bindedSend=function(a,c){b.__send(a,c)}},__free:function(){this.__fn=null,this.__bindedSend=null},__onTick:function(){r.call(this.__fn,[this.__bindedSend])}}),F("fromPoll",{__init:function(a){this.__fn=new r(a[0])},__free:function(){this.__fn=null},__onTick:function(){this.__send("value",r.call(this.__fn))}}),F("interval",{__init:function(a){this.__x=a[0]},__free:function(){this.__x=null},__onTick:function(){this.__send("value",this.__x)}}),F("sequentially",{__init:function(a){this.__xs=l(a[0]),0===this.__xs.length&&this.__send("end")},__free:function(){this.__xs=null},__onTick:function(){switch(this.__xs.length){case 0:this.__send("end");break;case 1:this.__send("value",this.__xs[0]),this.__send("end");break;default:this.__send("value",this.__xs.shift())}}}),F("repeatedly",{__init:function(a){this.__xs=l(a[0]),this.__i=-1},__onTick:function(){this.__xs.length>0&&(this.__i=(this.__i+1)%this.__xs.length,this.__send("value",this.__xs[this.__i]))}}),F("later",{__init:function(a){this.__x=a[0]},__free:function(){this.__x=null},__onTick:function(){this.__send("value",this.__x),this.__send("end")}}),"function"==typeof define&&define.amd?(define([],function(){return J}),a.Kefir=J):"object"==typeof module&&"object"==typeof exports?(module.exports=J,J.Kefir=J):a.Kefir=J}(this);