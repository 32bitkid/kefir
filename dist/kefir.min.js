/*! kefir - 0.1.12
 *  https://github.com/pozadi/kefir
 */
!function(a){"use strict";function b(a,b,c){return a&&b in a?a[b]:c}function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function d(a){var b=function(){};return b.prototype=a,new b}function e(){var a,b,d,e=arguments.length;if(1===e)return arguments[0];for(a=arguments[0],b=1;e>b;b++)for(d in arguments[b])c(arguments[b],d)&&(a[d]=arguments[b][d]);return a}function f(a,b){var c,f=arguments.length;for(a.prototype=d(b.prototype),a.prototype.constructor=a,c=2;f>c;c++)e(a.prototype,arguments[c]);return a}function g(a){return 1===a.length&&p(a[0])?a[0]:m(a)}function h(a,b){if(o(a))return a;if(null!=b&&o(b[a]))return b[a];throw new Error("not a function: "+a+" in "+b)}function i(a,b,c){if(null!=b)return c&&0!==c.length?a.apply(b,c):a.call(b);if(!c||0===c.length)return a();switch(c.length){case 1:return a(c[0]);case 2:return a(c[0],c[1]);case 3:return a(c[0],c[1],c[2])}return a.apply(null,c)}function j(a,b){var c,d,e=new Array(a.length+b.length),f=0;for(c=a.length,d=0;c>d;d++,f++)e[f]=a[d];for(c=b.length,d=0;c>d;d++,f++)e[f]=b[d];return e}function k(a){var b,c=a.length,d=new Array(c);for(b=0;c>b;b++)d[b]=a[b];return d}function l(a,b,c){return a.length>b?Array.prototype.slice.call(a,b):c}function m(a){return p(a)?a:k(a)}function n(a){return a.charAt(0).toUpperCase()+a.slice(1)}function o(a){return"function"==typeof a}function p(a){return"[object Array]"===Object.prototype.toString.call(a)}function q(a,b){var c,d;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;if(a.length!==b.length)return!1;for(d=0,c=a.length;c>d;d++)if(a[d]!==b[d])return!1;return!0}function r(a){if(o(a)||a instanceof r)return a;if(!a||!a.length)throw new Error("can't convert to Callable "+a);if(1===a.length){if(o(a[0]))return a[0];throw new Error("can't convert to Callable "+a)}this.fn=h(a[0],a[1]),this.context=a[1],this.args=l(a,2,null)}function s(){this.value=[],this.error=[],this.both=[],this.end=[]}function t(){this.__subscribers=new s,this.__ended=!1,this.__active=!1,this.__current={value:C,error:C}}function u(a){t.call(this),this.__fn=new r(a)}function v(a){t.call(this),this.__send("value",a),this.__send("end")}function w(a){t.call(this),this.__send("error",a),this.__send("end")}function x(a,b){return a===b}function y(a,b){function c(a,b){t.call(this),this.__source=a,this.__init(b),this.__ended||this.__source.on("end",[this.__handleEnd,this]),!this.__ended&&this.__source.has("value")&&this.__handleValue(this.__source.get("value"),!0),!this.__ended&&this.__source.has("error")&&this.__handleError(this.__source.get("error"),!0)}f(c,t,{__name:n(a)+"Property",__init:function(){},__free:function(){},__handleValue:function(a){this.__send("value",a)},__handleError:function(a){this.__send("error",a)},__handleEnd:function(){this.__send("end")},__handleBoth:function(a,b){"value"===a?this.__handleValue(b):this.__handleError(b)},__onActivation:function(){this.__source.on("both",[this.__handleBoth,this])},__onDeactivation:function(){this.__source.off("both",[this.__handleBoth,this])},__clear:function(){t.prototype.__clear.call(this),this.__source=null,this.__free()}},b),t.prototype[a]=function(){return new c(this,arguments)}}function z(a,b,c){function d(a){t.call(this),this.__multSubscriber=new A([this.__handleBoth,this]),this.__init(a)}return f(d,t,{__name:n(a)+"Property",__init:function(){},__free:function(){},__handleValue:function(a){this.__send("value",a)},__handleError:function(a){this.__send("error",a)},__handleBoth:function(a,b,c){"value"===a?this.__handleValue(b,c):this.__handleError(b,c)},__onActivation:function(){this.__multSubscriber.start()},__onDeactivation:function(){this.__multSubscriber.stop()},__clear:function(){t.prototype.__clear.call(this),this.__multSubscriber.removeAll(),this.__multSubscriber=null,this.__free()}},b),c||(F[a]=function(){return new d(arguments)}),d}function A(a){this.listener=new r(a),this.properties=[],this.active=!1}function B(a,b){function c(a,b){t.call(this),this.__wait=a,this.__intervalId=null;var c=this;this.__bindedOnTick=function(){c.__onTick()},this.__init(b)}f(c,t,{__name:n(a)+"Property",__init:function(){},__free:function(){},__onTick:function(){},__onActivation:function(){this.__intervalId=setInterval(this.__bindedOnTick,this.__wait)},__onDeactivation:function(){null!==this.__intervalId&&(clearInterval(this.__intervalId),this.__intervalId=null)},__clear:function(){t.prototype.__clear.call(this),this.__bindedOnTick=null,this.__free()}},b),F[a]=function(a){return new c(a,l(arguments,1,[]))}}var C=["<nothing>"],D=Date.now?function(){return Date.now()}:function(){return(new Date).getTime()},E=function(a){return"[object Arguments]"===Object.prototype.toString.call(a)};E(arguments)||(E=function(a){return!(!a||!c(a,"callee"))});var F={};r.call=function(a,b){return o(a)?i(a,null,b):a instanceof r?(a.args&&(b=b?j(a.args,b):a.args),i(a.fn,a.context,b)):r.call(new r(a),b)},r.isEqual=function(a,b){return a===b?!0:(a=new r(a),b=new r(b),o(a)||o(b)?a===b:a.fn===b.fn&&a.context===b.context&&q(a.args,b.args))},e(s.prototype,{add:function(a,b){this[a].push(new r(b))},remove:function(a,b){var c,d=new r(b),e=this[a],f=e.length;for(c=0;f>c;c++)if(r.isEqual(e[c],d))return void e.splice(c,1)},call:function(a,b){var c,d=this[a],e=d.length;if(0!==e)if(1===e)r.call(d[0],b);else for(d=k(d),c=0;e>c;c++)r.call(d[c],b)},hasValueOrError:function(){return this.value.length>0||this.error.length>0||this.both.length>0}}),F.Property=t,e(t.prototype,{__name:"Property",__onActivation:function(){},__onDeactivation:function(){},__setActive:function(a){this.__active!==a&&(this.__active=a,a?this.__onActivation():this.__onDeactivation())},__clear:function(){this.__setActive(!1),this.__subscribers=null,this.__ended=!0},__send:function(a,b){this.__ended||("end"===a?(this.__subscribers.call("end",[]),this.__clear()):(this.__current[a]=b,this.__subscribers.call(a,[b]),this.__subscribers.call("both",[a,b])))},on:function(a,b){return this.__ended?"end"===a&&r.call(b):(this.__subscribers.add(a,b),"end"!==a&&this.__setActive(!0)),this},off:function(a,b){return this.__ended||(this.__subscribers.remove(a,b),"end"===a||this.__subscribers.hasValueOrError()||this.__setActive(!1)),this},watch:function(a,b){return"both"===a?(this.has("value")&&r.call(b,["value",this.get("value"),!0]),this.has("error")&&r.call(b,["error",this.get("error"),!0])):this.has(a)&&r.call(b,[this.get(a),!0]),this.on(a,b)},has:function(a){return"value"===a||"error"===a?this.__current[a]!==C:!1},get:function(a,b){return this.has(a)?this.__current[a]:b},isEnded:function(){return this.__ended},isActive:function(){return this.__active},toString:function(){return"["+this.__name+"]"}}),t.prototype.log=function(a){return null==a&&(a=this.toString()),this.watch("both",function(b,c,d){console.log(a,"<"+b+(d?":initial":"")+">",c)}),this.on("end",function(){console.log(a,"<end>")}),this},f(u,t,{__name:"FromBinderProperty",__onActivation:function(){var a=this;this.__unsubscribe=r.call(this.__fn,[function(b,c){a.__send(b,c)}])},__onDeactivation:function(){o(this.__unsubscribe)&&this.__unsubscribe(),this.__unsubscribe=null},__clear:function(){t.prototype.__clear.call(this),this.__fn=null}}),F.fromBinder=function(a){return new u(a)};var G=new t;G.__send("end"),G.__name="NeverProperty",F.empty=function(){return G},f(v,t,{__name:"ConstantProperty"}),F.constant=function(a){return new v(a)},f(w,t,{__name:"ConstantErrorProperty"}),F.constantError=function(a){return new w(a)},y("withHandler",{__init:function(a){var b=this;this.__handler=new r(a[0]),this.__bindedSend=function(a,c){b.__send(a,c)}},__free:function(){this.__handler=null,this.__bindedSend=null},__handleValue:function(a,b){r.call(this.__handler,[this.__bindedSend,"value",a,b])},__handleError:function(a,b){r.call(this.__handler,[this.__bindedSend,"error",a,b])},__handleEnd:function(){r.call(this.__handler,[this.__bindedSend,"end"])}}),y("map",{__init:function(a){this.__fn=new r(a[0])},__free:function(){this.__fn=null},__handleValue:function(a){this.__send("value",r.call(this.__fn,[a]))}}),y("filter",{__init:function(a){this.__fn=new r(a[0])},__free:function(){this.__fn=null},__handleValue:function(a){r.call(this.__fn,[a])&&this.__send("value",a)}}),y("diff",{__init:function(a){this.__prev=a[0],this.__fn=new r(l(a,1))},__free:function(){this.__prev=null,this.__fn=null},__handleValue:function(a){this.__send("value",r.call(this.__fn,[this.__prev,a])),this.__prev=a}}),y("takeWhile",{__init:function(a){this.__fn=new r(a[0])},__free:function(){this.__fn=null},__handleValue:function(a){r.call(this.__fn,[a])?this.__send("value",a):this.__send("end")}}),y("take",{__init:function(a){this.__n=a[0],this.__n<=0&&this.__send("end")},__handleValue:function(a){this.__n--,this.__send("value",a),0===this.__n&&this.__send("end")}}),y("skip",{__init:function(a){this.__n=a[0]},__handleValue:function(a){this.__n<=0?this.__send("value",a):this.__n--}}),y("skipDuplicates",{__init:function(a){this.__fn=a.length>0?new r(a[0]):x,this.__prev=C},__free:function(){this.__fn=null,this.__prev=null},__handleValue:function(a){this.__prev!==C&&r.call(this.__fn,[this.__prev,a])||this.__send("value",a),this.__prev=a}}),y("skipWhile",{__init:function(a){this.__fn=new r(a[0]),this.__skip=!0},__free:function(){this.__fn=null},__handleValue:function(a){return this.__skip?void(r.call(this.__fn,[a])||(this.__skip=!1,this.__fn=null,this.__send("value",a))):void this.__send("value",a)}}),y("scan",{__init:function(a){this.__send("value",a[0]),this.__fn=new r(l(a,1))},__free:function(){this.__fn=null},__handleValue:function(a){this.__send("value",r.call(this.__fn,[this.get("value"),a]))}}),y("reduce",{__init:function(a){this.__result=a[0],this.__fn=new r(l(a,1))},__free:function(){this.__fn=null,this.__result=null},__handleValue:function(a){this.__result=r.call(this.__fn,[this.__result,a])},__handleEnd:function(){this.__send("value",this.__result),this.__send("end")}}),y("throttle",{__init:function(a){this.__wait=a[0],this.__leading=b(a[1],"leading",!0),this.__trailing=b(a[1],"trailing",!0),this.__trailingCallValue=null,this.__trailingCallTimeoutId=null,this.__endAfterTrailingCall=!1,this.__lastCallTime=0;var c=this;this.__makeTrailingCallBinded=function(){c.__makeTrailingCall()}},__free:function(){this.__trailingCallValue=null,this.__makeTrailingCallBinded=null},__handleValue:function(a,b){if(b)return void this.__send("value",a);var c=D();0!==this.__lastCallTime||this.__leading||(this.__lastCallTime=c);var d=this.__wait-(c-this.__lastCallTime);0>=d?(this.__cancelTralingCall(),this.__lastCallTime=c,this.__send("value",a)):this.__trailing&&this.__scheduleTralingCall(a,d)},__handleEnd:function(){this.__trailingCallTimeoutId?this.__endAfterTrailingCall=!0:this.__send("end")},__scheduleTralingCall:function(a,b){this.__trailingCallTimeoutId&&this.__cancelTralingCall(),this.__trailingCallValue=a,this.__trailingCallTimeoutId=setTimeout(this.__makeTrailingCallBinded,b)},__cancelTralingCall:function(){null!==this.__trailingCallTimeoutId&&(clearTimeout(this.__trailingCallTimeoutId),this.__trailingCallTimeoutId=null)},__makeTrailingCall:function(){this.__send("value",this.__trailingCallValue),this.__trailingCallTimeoutId=null,this.__trailingCallValue=null,this.__lastCallTime=this.__leading?D():0,this.__endAfterTrailingCall&&this.__send("end")}}),y("delay",{__init:function(a){this.__wait=a[0]},__handleValue:function(a,b){if(b)return void this.__send("value",a);var c=this;setTimeout(function(){c.__send("value",a)},this.__wait)},__handleEnd:function(){var a=this;setTimeout(function(){a.__send("end")},this.__wait)}}),z("merge",{__init:function(a){var b=g(a);if(b.length>0){for(var c=0;c<b.length;c++)this.__multSubscriber.add(b[c]);this.__multSubscriber.onLastRemoved([this.__send,this,"end"])}else this.__send("end")}}),e(A.prototype,{start:function(){if(!this.active){for(var a=0;a<this.properties.length;a++)this.properties[a].on("both",this.listener);this.active=!0}},stop:function(){if(this.active){for(var a=0;a<this.properties.length;a++)this.properties[a].off("both",this.listener);this.active=!1}},add:function(a){this.properties.push(a),a.on("end",[this.remove,this,a]),a.has("value")&&r.call(this.listener,["value",a.get("value"),!0]),a.has("error")&&r.call(this.listener,["error",a.get("error"),!0]),this.active&&a.on("both",this.listener)},remove:function(a){for(var b=0;b<this.properties.length;b++)if(this.properties[b]===a){this.properties.splice(b,1),a.off("end",[this.remove,this,a]),this.active&&a.off("both",this.listener);break}0===this.properties.length&&this.onLastRemovedCb&&r.call(this.onLastRemovedCb)},removeAll:function(){for(var a=0;a<this.properties.length;a++)this.properties[a].off("end",[this.remove,this,this.properties[a]]),this.active&&this.properties[a].off("both",this.listener);this.properties=[],this.onLastRemovedCb&&r.call(this.onLastRemovedCb)},onLastRemoved:function(a){this.onLastRemovedCb=new r(a)},hasStreams:function(){return this.properties.length>0}}),B("withInterval",{__init:function(a){this.__fn=new r(a[0]);var b=this;this.__bindedSend=function(a,c){b.__send(a,c)}},__free:function(){this.__fn=null,this.__bindedSend=null},__onTick:function(){r.call(this.__fn,[this.__bindedSend])}}),B("fromPoll",{__init:function(a){this.__fn=new r(a[0])},__free:function(){this.__fn=null},__onTick:function(){this.__send("value",r.call(this.__fn))}}),B("interval",{__init:function(a){this.__x=a[0]},__free:function(){this.__x=null},__onTick:function(){this.__send("value",this.__x)}}),B("sequentially",{__init:function(a){this.__xs=k(a[0]),0===this.__xs.length&&this.__send("end")},__free:function(){this.__xs=null},__onTick:function(){switch(this.__xs.length){case 0:this.__send("end");break;case 1:this.__send("value",this.__xs[0]),this.__send("end");break;default:this.__send("value",this.__xs.shift())}}}),B("repeatedly",{__init:function(a){this.__xs=k(a[0]),this.__i=-1},__onTick:function(){this.__xs.length>0&&(this.__i=(this.__i+1)%this.__xs.length,this.__send("value",this.__xs[this.__i]))}}),B("later",{__init:function(a){this.__x=a[0]},__free:function(){this.__x=null},__onTick:function(){this.__send("value",this.__x),this.__send("end")}}),"function"==typeof define&&define.amd?(define([],function(){return F}),a.Kefir=F):"object"==typeof module&&"object"==typeof exports?(module.exports=F,F.Kefir=F):a.Kefir=F}(this);