/*! Kefir - 0.1.0
 *  https://github.com/pozadi/kefir
 */
!function(a){"use strict";function b(){}function c(a){var b=function(){};return b.prototype=a,new b}function d(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function e(a,b,e){return a.prototype=c(b.prototype),a.prototype.constructor=a,e&&d(a.prototype,e),a}function f(a,b){for(var c=0;c<a.length;)a[c]===b?a.splice(c,1):c++}function g(a,b){for(var c=0;c<a.length;c++)a[c]===b&&(a[c]=null)}function h(a){for(var b=0;b<a.length;b++)if(a[b])return!1;return!0}function i(a){return"[object Array]"===Object.prototype.toString.call(a[0])?a[0]:Array.prototype.slice.call(a)}var j={};j.END=["<end>"],j.NO_MORE=["<no more>"];var k=j.Stream=e(function(a,b){"function"==typeof a&&(this.__onFirstSubscribed=a),"function"==typeof a&&(this.__onLastUsubscribed=b),this.__subscribers=[],this.__endSubscribers=[]},Object,{_send:function(a){if(!this.isEnded())if(a===j.END)this.__end();else for(var b=0;b<this.__subscribers.length;b++){var c=this.__subscribers[b];"function"==typeof c&&j.NO_MORE===c(a)&&this.unsubscribe(c)}},subscribe:function(a){this.isEnded()||(this.__subscribers.push(a),1===this.__subscribers.length&&this.__onFirstSubscribed())},unsubscribe:function(a){this.isEnded()||(g(this.__subscribers,a),h(this.__subscribers)&&(this.__subscribers=[],this.__onLastUsubscribed()))},onEnd:function(a){this.isEnded()?a():this.__endSubscribers.push(a)},offEnd:function(a){this.isEnded()||f(this.__endSubscribers,a)},isEnded:function(){return null===this.__subscribers},hasSubscribers:function(){return!this.isEnded()&&this.__subscribers.length>0},__onFirstSubscribed:b,__onLastUsubscribed:b,__end:function(){if(!this.isEnded()){this.__onLastUsubscribed(),this.hasOwnProperty(this.__onFirstSubscribed)&&(this.__onFirstSubscribed=null),this.hasOwnProperty(this.__onLastUsubscribed)&&(this.__onLastUsubscribed=null),this.__subscribers=null;for(var a=0;a<this.__endSubscribers.length;a++)this.__endSubscribers[a]();this.__endSubscribers=null}}});j.__neverObj=c(k.prototype),j.__neverObj.__subscribers=null,j.never=function(){return j.__neverObj};var l=j.OnceStream=e(function(a){k.call(this),this.__value=a},k,{__onFirstSubscribed:function(){this._send(this.__value),this.__value=null,this._send(j.END)}});j.once=function(a){return new l(a)};var m=j.Property=e(function(a,b,c){k.call(this,a,b),this.__hasCached="undefined"!=typeof c,this.__cached=c},k,{subscribe:function(a){this.__hasCached&&a(this.__cached),k.prototype.subscribe.call(this,a)},_send:function(a){this.isEnded()||(this.__hasCached=!0,this.__cached=a),k.prototype._send.call(this,a)}}),n=e(function(a,b){m.call(this,null,null,b),this.__sourceStream=a;var c=this;this.__deliver=function(a){c._send(a)},a.onEnd(function(){c._send(j.END)})},m,{__onFirstSubscribed:function(){this.__sourceStream.subscribe(this.__deliver)},__onLastUsubscribed:function(){this.__sourceStream.unsubscribe(this.__deliver)},__end:function(){k.prototype.__end.call(this),this.__sourceStream=null,this.__deliver=null}});j.toProperty=function(a,b){return new n(a,b)},k.prototype.toProperty=function(a){return j.toProperty(this,a)};var o=j.FromBinderStream=e(function(a){k.call(this),this.__generator=a;var b=this;this.__deliver=function(a){b._send(a)}},k,{__onFirstSubscribed:function(){this.__generatorUsubscriber=this.__generator(this.__deliver)},__onLastUsubscribed:function(){"function"==typeof this.__generatorUsubscriber&&this.__generatorUsubscriber(),this.__generatorUsubscriber=null},__end:function(){k.prototype.__end.call(this),this.__generator=null,this.__deliver=null}});j.fromBinder=function(a){return new o(a)};var p=(j.Bus=e(function(){k.call(this),this.__plugged=[];var a=this;this.push=function(b){a._send(b)}},k,{plug:function(a){if(!this.isEnded()){this.__plugged.push(a),this.hasSubscribers()&&a.subscribe(this.push);var b=this;a.onEnd(function(){b.unplug(a)})}},unplug:function(a){this.isEnded()||(a.unsubscribe(this.push),f(this.__plugged,a))},end:function(){this._send(j.END)},__onFirstSubscribed:function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].subscribe(this.push)},__onLastUsubscribed:function(){for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].unsubscribe(this.push)},__end:function(){k.prototype.__end.call(this),this.__plugged=null,this.push=b}}),j.FromPollStream=e(function(a,b){k.call(this),this.__interval=a,this.__intervalId=null;var c=this;this.__deliver=function(){c._send(b())}},k,{__onFirstSubscribed:function(){this.__intervalId=setInterval(this.__deliver,this.__interval)},__onLastUsubscribed:function(){null!==this.__intervalId&&(clearInterval(this.__intervalId),this.__intervalId=null)},__end:function(){k.prototype.__end.call(this),this.__deliver=null}}));j.fromPoll=function(a,b){return new p(a,b)},j.interval=function(a,b){return new p(a,function(){return b})};var q=j.MappedStream=e(function(a,b){k.call(this),this.__sourceStream=a;var c=this;this.__deliver=function(a){c._send(b(a))},a.onEnd(function(){c._send(j.END)})},k,{__onFirstSubscribed:function(){this.__sourceStream.subscribe(this.__deliver)},__onLastUsubscribed:function(){this.__sourceStream.unsubscribe(this.__deliver)},__end:function(){k.prototype.__end.call(this),this.__sourceStream=null,this.__deliver=null}});j.map=function(a,b){return new q(a,b)},k.prototype.map=function(a){return j.map(this,a)};var r=j.FilteredStream=e(function(a,b){k.call(this),this.__sourceStream=a;var c=this;this.__deliver=function(a){b(a)&&c._send(a)},a.onEnd(function(){c._send(j.END)})},q);j.filter=function(a,b){return new r(a,b)},k.prototype.filter=function(a){return j.filter(this,a)};var s=j.TakeWhileStream=e(function(a,b){k.call(this),this.__sourceStream=a;var c=this;this.__deliver=function(a){c._send(b(a)?a:j.END)},a.onEnd(function(){c._send(j.END)})},q);j.takeWhile=function(a,b){return new s(a,b)},k.prototype.takeWhile=function(a){return j.takeWhile(this,a)},j.take=function(a,b){return new s(a,function(){return b-->0})},k.prototype.take=function(a){return j.take(this,a)};var t=j.FlatMappedStream=e(function(a,b){k.call(this),this.__sourceStream=a,this.__plugged=[];var c=this;this.__deliver=function(a){c._send(a)},this.__plugResult=function(a){c.__plug(b(a))},a.onEnd(function(){c._send(j.END)})},k,{__onFirstSubscribed:function(){this.__sourceStream.subscribe(this.__plugResult);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].subscribe(this.__deliver)},__onLastUsubscribed:function(){this.__sourceStream.unsubscribe(this.__plugResult);for(var a=0;a<this.__plugged.length;a++)this.__plugged[a].unsubscribe(this.__deliver)},__plug:function(a){this.__plugged.push(a),this.hasSubscribers()&&a.subscribe(this.__deliver);var b=this;a.onEnd(function(){b.__unplug(a)})},__unplug:function(a){this.isEnded()||(a.unsubscribe(this.__deliver),f(this.__plugged,a))},__end:function(){k.prototype.__end.call(this),this.__sourceStream=null,this.__deliver=null,this.__plugResult=null,this.__plugged=null}});j.flatMap=function(a,b){return new t(a,b)},k.prototype.flatMap=function(a){return j.flatMap(this,a)};var u=j.MergedStream=e(function(){k.call(this),this.__sourceStreams=i(arguments);var a=this;this.__deliver=function(b){a._send(b)};for(var b=0;b<this.__sourceStreams.length;b++)this.__sourceStreams[b].onEnd(this.__unplugFor(this.__sourceStreams[b]))},k,{__onFirstSubscribed:function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a].subscribe(this.__deliver)},__onLastUsubscribed:function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a].unsubscribe(this.__deliver)},__unplug:function(a){a.unsubscribe(this.__deliver),f(this.__sourceStreams,a),0===this.__sourceStreams.length&&this._send(j.END)},__unplugFor:function(a){var b=this;return function(){b.__unplug(a)}},__end:function(){k.prototype.__end.call(this),this.__sourceStreams=null,this.__deliver=null}});j.merge=function(){return new u(i(arguments))},k.prototype.merge=function(){return j.merge([this].concat(i(arguments)))};var v=j.CombinedStream=e(function(a,b){k.call(this),this.__sourceStreams=a,this.__cachedValues=new Array(a.length),this.__hasCached=new Array(a.length),this.__receiveFns=new Array(a.length),this.__mapFn=b;for(var c=0;c<this.__sourceStreams.length;c++)this.__receiveFns[c]=this.__receiveFor(c),this.__sourceStreams[c].onEnd(this.__unplugFor(c))},k,{__onFirstSubscribed:function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a]&&this.__sourceStreams[a].subscribe(this.__receiveFns[a])},__onLastUsubscribed:function(){for(var a=0;a<this.__sourceStreams.length;a++)this.__sourceStreams[a]&&this.__sourceStreams[a].unsubscribe(this.__receiveFns[a])},__unplug:function(a){this.__sourceStreams[a].unsubscribe(this.__receiveFns[a]),this.__sourceStreams[a]=null,this.__receiveFns[a]=null,h(this.__sourceStreams)&&this._send(j.END)},__unplugFor:function(a){var b=this;return function(){b.__unplug(a)}},__receive:function(a,b){this.__hasCached[a]=!0,this.__cachedValues[a]=b,this.__allCached()&&this._send("function"==typeof this.__mapFn?this.__mapFn.apply(null,this.__cachedValues):this.__cachedValues.slice(0))},__receiveFor:function(a){var b=this;return function(c){b.__receive(a,c)}},__allCached:function(){for(var a=0;a<this.__hasCached.length;a++)if(!this.__hasCached[a])return!1;return!0},__end:function(){k.prototype.__end.call(this),this.__sourceStreams=null,this.__cachedValues=null,this.__hasCached=null,this.__receiveFns=null,this.__mapFn=null}});j.combine=function(a,b){return new v(a,b)},k.prototype.combine=function(a,b){return j.combine([this].concat(a),b)},k.prototype.log=function(a){function b(b){a?console.log(a,b):console.log(b)}this.subscribe(b),this.onEnd(function(){b(j.END)})},"function"==typeof define&&define.amd?(define([],function(){return j}),a.Kefir=j):"object"==typeof module&&"object"==typeof exports?(module.exports=j,j.Kefir=j):a.Kefir=j}(this);