/*! kefir - 0.1.12
 *  https://github.com/pozadi/kefir
 */
!function(a){"use strict";function b(a,b,c){return a&&b in a?a[b]:c}function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function d(a){var b=function(){};return b.prototype=a,new b}function e(){var a,b,d,e=arguments.length;if(1===e)return arguments[0];for(a=arguments[0],b=1;e>b;b++)for(d in arguments[b])c(arguments[b],d)&&(a[d]=arguments[b][d]);return a}function f(a,b){var c,f=arguments.length;for(a.prototype=d(b.prototype),a.prototype.constructor=a,c=2;f>c;c++)e(a.prototype,arguments[c]);return a}function g(a,b){if(m(a))return a;if(null!=b&&m(b[a]))return b[a];throw new Error("not a function: "+a+" in "+b)}function h(a,b,c){if(null!=b)return c&&0!==c.length?a.apply(b,c):a.call(b);if(!c||0===c.length)return a();switch(c.length){case 1:return a(c[0]);case 2:return a(c[0],c[1]);case 3:return a(c[0],c[1],c[2])}return a.apply(null,c)}function i(a,b){var c,d,e=new Array(a.length+b.length),f=0;for(c=a.length,d=0;c>d;d++,f++)e[f]=a[d];for(c=b.length,d=0;c>d;d++,f++)e[f]=b[d];return e}function j(a){var b,c=a.length,d=new Array(c);for(b=0;c>b;b++)d[b]=a[b];return d}function k(a,b,c){return a.length>b?Array.prototype.slice.call(a,b):c}function l(a){return a.charAt(0).toUpperCase()+a.slice(1)}function m(a){return"function"==typeof a}function n(a,b){var c,d;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;if(a.length!==b.length)return!1;for(d=0,c=a.length;c>d;d++)if(a[d]!==b[d])return!1;return!0}function o(a){if(m(a)||a instanceof o)return a;if(!a||!a.length)throw new Error("can't convert to Callable "+a);if(1===a.length){if(m(a[0]))return a[0];throw new Error("can't convert to Callable "+a)}this.fn=g(a[0],a[1]),this.context=a[1],this.args=k(a,2,null)}function p(){this.value=[],this.error=[],this.both=[],this.end=[]}function q(){this.__subscribers=new p,this.__ended=!1,this.__active=!1,this.__current={value:w,error:w}}function r(a){q.call(this),this.__fn=new o(a)}function s(a){q.call(this),this.__send("value",a),this.__send("end")}function t(a){q.call(this),this.__send("error",a),this.__send("end")}function u(a,b){return a===b}function v(a,b){function c(a,b){q.call(this),this.__source=a,this.__init(b),this.__ended||this.__source.on("end",[this.__handleEnd,this]),!this.__ended&&this.__source.has("value")&&this.__handleValue(this.__source.get("value"),!0),!this.__ended&&this.__source.has("error")&&this.__handleError(this.__source.get("error"),!0)}f(c,q,{__name:l(a)+"Property",__init:function(){},__free:function(){},__handleValue:function(a){this.__send("value",a)},__handleError:function(a){this.__send("error",a)},__handleEnd:function(){this.__send("end")},__handleBoth:function(a,b){"value"===a?this.__handleValue(b):this.__handleError(b)},__onActivation:function(){this.__source.on("both",[this.__handleBoth,this])},__onDeactivation:function(){this.__source.off("both",[this.__handleBoth,this])},__clear:function(){q.prototype.__clear.call(this),this.__source=null,this.__free()}},b),q.prototype[a]=function(){return new c(this,arguments)}}var w=["<nothing>"],x=Date.now?function(){return Date.now()}:function(){return(new Date).getTime()},y=function(a){return"[object Arguments]"===Object.prototype.toString.call(a)};y(arguments)||(y=function(a){return!(!a||!c(a,"callee"))});var z={};o.call=function(a,b){return m(a)?h(a,null,b):a instanceof o?(a.args&&(b=b?i(a.args,b):a.args),h(a.fn,a.context,b)):o.call(new o(a),b)},o.isEqual=function(a,b){return a===b?!0:(a=new o(a),b=new o(b),m(a)||m(b)?a===b:a.fn===b.fn&&a.context===b.context&&n(a.args,b.args))},e(p.prototype,{add:function(a,b){this[a].push(new o(b))},remove:function(a,b){var c,d=new o(b),e=this[a],f=e.length;for(c=0;f>c;c++)if(o.isEqual(e[c],d))return void e.splice(c,1)},call:function(a,b){var c,d=this[a],e=d.length;if(0!==e)if(1===e)o.call(d[0],b);else for(d=j(d),c=0;e>c;c++)o.call(d[c],b)},hasValueOrError:function(){return this.value.length>0||this.error.length>0||this.both.length>0}}),z.Property=q,e(q.prototype,{__name:"Property",__onActivation:function(){},__onDeactivation:function(){},__setActive:function(a){this.__active!==a&&(this.__active=a,a?this.__onActivation():this.__onDeactivation())},__clear:function(){this.__setActive(!1),this.__subscribers=null,this.__ended=!0},__send:function(a,b){this.__ended||("end"===a?(this.__subscribers.call("end",[]),this.__clear()):(this.__current[a]=b,this.__subscribers.call(a,[b]),this.__subscribers.call("both",[a,b])))},on:function(a,b){return this.__ended?"end"===a&&o.call(b):(this.__subscribers.add(a,b),"end"!==a&&this.__setActive(!0)),this},off:function(a,b){return this.__ended||(this.__subscribers.remove(a,b),"end"===a||this.__subscribers.hasValueOrError()||this.__setActive(!1)),this},watch:function(a,b){return"both"===a?(this.has("value")&&o.call(b,["value",this.get("value"),!0]),this.has("error")&&o.call(b,["error",this.get("error"),!0])):this.has(a)&&o.call(b,[this.get(a),!0]),this.on(a,b)},has:function(a){return"value"===a||"error"===a?this.__current[a]!==w:!1},get:function(a,b){return this.has(a)?this.__current[a]:b},isEnded:function(){return this.__ended},isActive:function(){return this.__active},toString:function(){return"["+this.__name+"]"}}),q.prototype.log=function(a){return null==a&&(a=this.toString()),this.watch("both",function(b,c,d){console.log(a,"<"+b+(d?":initial":"")+">",c)}),this.on("end",function(){console.log(a,"<end>")}),this},f(r,q,{__name:"FromBinderProperty",__onActivation:function(){var a=this;this.__unsubscribe=o.call(this.__fn,[function(b,c){a.__send(b,c)}])},__onDeactivation:function(){m(this.__unsubscribe)&&this.__unsubscribe(),this.__unsubscribe=null},__clear:function(){q.prototype.__clear.call(this),this.__fn=null}}),z.fromBinder=function(a){return new r(a)};var A=new q;A.__send("end"),A.__name="NeverProperty",z.empty=function(){return A},f(s,q,{__name:"ConstantProperty"}),z.constant=function(a){return new s(a)},f(t,q,{__name:"ConstantErrorProperty"}),z.constantError=function(a){return new t(a)},v("withHandler",{__init:function(a){var b=this;this.__handler=new o(a[0]),this.__bindedSend=function(a,c){b.__send(a,c)}},__free:function(){this.__handler=null,this.__bindedSend=null},__handleValue:function(a,b){o.call(this.__handler,[this.__bindedSend,"value",a,b])},__handleError:function(a,b){o.call(this.__handler,[this.__bindedSend,"error",a,b])},__handleEnd:function(){o.call(this.__handler,[this.__bindedSend,"end"])}}),v("map",{__init:function(a){this.__fn=new o(a[0])},__free:function(){this.__fn=null},__handleValue:function(a){this.__send("value",o.call(this.__fn,[a]))}}),v("filter",{__init:function(a){this.__fn=new o(a[0])},__free:function(){this.__fn=null},__handleValue:function(a){o.call(this.__fn,[a])&&this.__send("value",a)}}),v("diff",{__init:function(a){this.__prev=a[0],this.__fn=new o(k(a,1))},__free:function(){this.__prev=null,this.__fn=null},__handleValue:function(a){this.__send("value",o.call(this.__fn,[this.__prev,a])),this.__prev=a}}),v("takeWhile",{__init:function(a){this.__fn=new o(a[0])},__free:function(){this.__fn=null},__handleValue:function(a){o.call(this.__fn,[a])?this.__send("value",a):this.__send("end")}}),v("take",{__init:function(a){this.__n=a[0],this.__n<=0&&this.__send("end")},__handleValue:function(a){this.__n--,this.__send("value",a),0===this.__n&&this.__send("end")}}),v("skip",{__init:function(a){this.__n=a[0]},__handleValue:function(a){this.__n<=0?this.__send("value",a):this.__n--}}),v("skipDuplicates",{__init:function(a){this.__fn=a.length>0?new o(a[0]):u,this.__prev=w},__free:function(){this.__fn=null,this.__prev=null},__handleValue:function(a){this.__prev!==w&&o.call(this.__fn,[this.__prev,a])||this.__send("value",a),this.__prev=a}}),v("skipWhile",{__init:function(a){this.__fn=new o(a[0]),this.__skip=!0},__free:function(){this.__fn=null},__handleValue:function(a){return this.__skip?void(o.call(this.__fn,[a])||(this.__skip=!1,this.__fn=null,this.__send("value",a))):void this.__send("value",a)}}),v("scan",{__init:function(a){this.__send("value",a[0]),this.__fn=new o(k(a,1))},__free:function(){this.__fn=null},__handleValue:function(a){this.__send("value",o.call(this.__fn,[this.get("value"),a]))}}),v("reduce",{__init:function(a){this.__result=a[0],this.__fn=new o(k(a,1))},__free:function(){this.__fn=null,this.__result=null},__handleValue:function(a){this.__result=o.call(this.__fn,[this.__result,a])},__handleEnd:function(){this.__send("value",this.__result),this.__send("end")}}),v("throttle",{__init:function(a){this.__wait=a[0],this.__leading=b(a[1],"leading",!0),this.__trailing=b(a[1],"trailing",!0),this.__trailingCallValue=null,this.__trailingCallTimeoutId=null,this.__endAfterTrailingCall=!1,this.__lastCallTime=0;var c=this;this.__makeTrailingCallBinded=function(){c.__makeTrailingCall()}},__free:function(){this.__trailingCallValue=null,this.__makeTrailingCallBinded=null},__handleValue:function(a,b){if(b)return void this.__send("value",a);var c=x();0!==this.__lastCallTime||this.__leading||(this.__lastCallTime=c);var d=this.__wait-(c-this.__lastCallTime);0>=d?(this.__cancelTralingCall(),this.__lastCallTime=c,this.__send("value",a)):this.__trailing&&this.__scheduleTralingCall(a,d)},__handleEnd:function(){this.__trailingCallTimeoutId?this.__endAfterTrailingCall=!0:this.__send("end")},__scheduleTralingCall:function(a,b){this.__trailingCallTimeoutId&&this.__cancelTralingCall(),this.__trailingCallValue=a,this.__trailingCallTimeoutId=setTimeout(this.__makeTrailingCallBinded,b)},__cancelTralingCall:function(){null!==this.__trailingCallTimeoutId&&(clearTimeout(this.__trailingCallTimeoutId),this.__trailingCallTimeoutId=null)},__makeTrailingCall:function(){this.__send("value",this.__trailingCallValue),this.__trailingCallTimeoutId=null,this.__trailingCallValue=null,this.__lastCallTime=this.__leading?x():0,this.__endAfterTrailingCall&&this.__send("end")}}),v("delay",{__init:function(a){this.__wait=a[0]},__handleValue:function(a,b){if(b)return void this.__send("value",a);var c=this;setTimeout(function(){c.__send("value",a)},this.__wait)},__handleEnd:function(){var a=this;setTimeout(function(){a.__send("end")},this.__wait)}}),"function"==typeof define&&define.amd?(define([],function(){return z}),a.Kefir=z):"object"==typeof module&&"object"==typeof exports?(module.exports=z,z.Kefir=z):a.Kefir=z}(this);