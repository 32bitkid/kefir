/*! kefir - 0.2.4
 *  https://github.com/pozadi/kefir
 */

!function(a){"use strict";function b(a,b,c){return a&&b in a?a[b]:c}function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function d(a){var b=function(){};return b.prototype=a,new b}function e(a){var b,c,d=arguments.length;for(b=1;d>b;b++)for(c in arguments[b])a[c]=arguments[b][c];return a}function f(a,b){var c,f=arguments.length;for(a.prototype=d(b.prototype),a.prototype.constructor=a,c=2;f>c;c++)e(a.prototype,arguments[c]);return a}function g(a){return 1===a.length&&R(a[0])?a[0]:p(a)}function h(a,b){if(q(a))return a;if(null!=b&&q(b[a]))return b[a];throw new Error("not a function: "+a+" in "+b)}function i(a,b,c){var d=c?c.length:0;if(null==b)switch(d){case 0:return a();case 1:return a(c[0]);case 2:return a(c[0],c[1]);case 3:return a(c[0],c[1],c[2]);case 4:return a(c[0],c[1],c[2],c[3]);default:return a.apply(null,c)}else switch(d){case 0:return a.call(b);default:return a.apply(b,c)}}function j(a,b,c,d){var e=c[0],f=c[1],g=c[2],h=c[3];if(null==b)switch(d){case 0:switch(c.length){case 0:return a;case 1:return function(){return a(e)};case 2:return function(){return a(e,f)};case 3:return function(){return a(e,f,g)};case 4:return function(){return a(e,f,g,h)};default:return function(){return a.apply(null,c)}}break;case 1:switch(c.length){case 0:return a;case 1:return function(b){return a(e,b)};case 2:return function(b){return a(e,f,b)};case 3:return function(b){return a(e,f,g,b)};case 4:return function(b){return a(e,f,g,h,b)};default:return function(b){return a.apply(null,k(c,[b]))}}break;case 2:switch(c.length){case 0:return a;case 1:return function(b,c){return a(e,b,c)};case 2:return function(b,c){return a(e,f,b,c)};case 3:return function(b,c){return a(e,f,g,b,c)};case 4:return function(b,c){return a(e,f,g,h,b,c)};default:return function(b,d){return a.apply(null,k(c,[b,d]))}}break;default:switch(c.length){case 0:return a;default:return function(){return a.apply(null,k(c,arguments))}}}else switch(d){case 0:switch(c.length){case 0:return function(){return a.call(b)};default:return function(){return a.apply(b,c)}}break;case 1:switch(c.length){case 0:return function(c){return a.call(b,c)};case 1:return function(c){return a.call(b,e,c)};case 2:return function(c){return a.call(b,e,f,c)};case 3:return function(c){return a.call(b,e,f,g,c)};case 4:return function(c){return a.call(b,e,f,g,h,c)};default:return function(d){return a.apply(b,k(c,[d]))}}break;case 2:switch(c.length){case 0:return function(c,d){return a.call(b,c,d)};case 1:return function(c,d){return a.call(b,e,c,d)};case 2:return function(c,d){return a.call(b,e,f,c,d)};case 3:return function(c,d){return a.call(b,e,f,g,c,d)};case 4:return function(c,d){return a.call(b,e,f,g,h,c,d)};default:return function(d,e){return a.apply(b,k(c,[d,e]))}}break;default:switch(c.length){case 0:return function(){return a.apply(b,arguments)};default:return function(){return a.apply(b,k(c,arguments))}}}}function k(a,b){var c,d,e=new Array(a.length+b.length),f=0;for(c=a.length,d=0;c>d;d++,f++)e[f]=a[d];for(c=b.length,d=0;c>d;d++,f++)e[f]=b[d];return e}function l(a){var b,c=a.length,d=new Array(c);for(b=0;c>b;b++)d[b]=a[b];return d}function m(a,b){var c,d=a.length;for(c=0;d>c;c++)a[c]=b}function n(a,b){var c,d=a.length;for(c=0;d>c;c++)if(a[c]===b)return!0;return!1}function o(a,b,c){return a.length>b?Array.prototype.slice.call(a,b):c}function p(a){return R(a)?a:l(a)}function q(a){return"function"==typeof a}function r(a){return R(a)||S(a)}function s(a,b){var c,d;if(null==a&&null==b)return!0;if(null==a||null==b)return!1;if(a.length!==b.length)return!1;for(d=0,c=a.length;c>d;d++)if(a[d]!==b[d])return!1;return!0}function t(){for(var a=0;a<arguments.length;a++)if(!arguments[a])return arguments[a];return arguments[a-1]}function u(){for(var a=0;a<arguments.length;a++)if(arguments[a])return arguments[a];return arguments[a-1]}function v(a,b){function c(a,b){B.call(this),this._wait=a,this._intervalId=null;var c=this;this._$onTick=function(){c._onTick()},this._init(b)}f(c,B,{_name:a,_init:function(){},_free:function(){},_onTick:function(){},_onActivation:function(){this._intervalId=setInterval(this._$onTick,this._wait)},_onDeactivation:function(){null!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)},_clear:function(){B.prototype._clear.call(this),this._$onTick=null,this._free()}},b),T[a]=function(a){return new c(a,o(arguments,1,[]))}}function w(a,b,c){function d(c){function d(b,d){c.call(this),this._source=b,this._name=b._name+"."+a,this._init(d)}return f(d,c,{_clear:function(){c.prototype._clear.call(this),this._source=null,this._free()}},b),d}c=e({streamMethod:function(a){return function(){return new a(this,arguments)}},propertyMethod:function(a,b){return function(){return new b(this,arguments)}}},c||{}),b=e({_init:function(){},_free:function(){},_handleValue:function(a,b){this._send("value",a,b)},_handleEnd:function(a,b){this._send("end",null,b)},_onActivationHook:function(){},_onDeactivationHook:function(){},_handleAny:function(a){switch(a.type){case"value":this._handleValue(a.value,a.current);break;case"end":this._handleEnd(a.value,a.current)}},_onActivation:function(){this._onActivationHook(),this._source.onAny([this._handleAny,this])},_onDeactivation:function(){this._onDeactivationHook(),this._source.offAny([this._handleAny,this])}},b||{});var g=d(B),h=d(C);c.streamMethod&&(B.prototype[a]=c.streamMethod(g,h)),c.propertyMethod&&(C.prototype[a]=c.propertyMethod(g,h))}function x(a,b){this.context=null==a[1]?null:a[1],this.fn=h(a[0],this.context),this.args=o(a,2,[]),this.invoke=j(this.fn,this.context,this.args,b)}function y(a,b){if(a instanceof x)return a;if(null==b&&(b=100),q(a))return new x([a],b);if(r(a))return new x(a,b);throw new Error("can't convert to Fn "+a)}function z(){this.value=[],this.end=[],this.any=[],this.total=0}function A(){this._subscribers=new z,this._active=!1,this._alive=!0}function B(){A.call(this)}function C(){A.call(this),this._current=P}function D(a,b){var c="<"+b.type+(b.isCurrent?":current":"")+">";"value"===b.type?console.log(a,c,b.value):console.log(a,c)}function E(a){B.call(this),0===a.length?this._send("end"):(this._sources=a,this._aliveCount=0)}function F(a,b,c){B.call(this),0===b.length?this._send("end"):(this._passiveCount=a.length,this._combinator=c?y(c):null,this._sources=k(a,b),this._aliveCount=0,this._currents=new Array(this._sources.length),m(this._currents,P),this._activating=!1,this._emitAfterActivation=!1,this._endAfterActivation=!1)}function G(){B.call(this),this._sources=[]}function H(){G.call(this)}function I(a,b){G.call(this),this._source=a,this._name=a._name+".flatMap",this._fn=b?y(b,1):null,this._mainEnded=!1,this._lastValue=null}function J(a){return function(){return new a(this,arguments)}}function K(a,b){return function(){return new b(this,arguments)}}function L(a){B.call(this),this._fn=y(a,1),this._unsubscribe=null}function M(){B.call(this)}function N(a){C.call(this),this._send("value",a),this._send("end")}function O(a){B.call(this),this._value=a}var P=["<nothing>"],Q=Date.now?function(){return Date.now()}:function(){return(new Date).getTime()},R=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},S=function(a){return"[object Arguments]"===Object.prototype.toString.call(a)};S(arguments)||(S=function(a){return!(!a||!c(a,"callee"))});var T={};x.prototype.apply=function(a){return i(this.invoke,null,a)},x.prototype.applyWithContext=function(a,b){return null===this.context?0===this.args.length?i(this.fn,a,b):i(this.fn,a,k(this.args,b)):this.apply(b)},y.isEqual=function(a,b){return a===b?!0:(a=y(a,null,!0),b=y(b,null,!0),a.fn===b.fn&&a.context===b.context&&s(a.args,b.args))},T.Fn=y,e(z.prototype,{add:function(a,b){var c="end"===a?0:1;this[a].push(y(b,c,!0)),this.total++},remove:function(a,b){var c,d=this[a],e=d.length;for(b=y(b),c=0;e>c;c++)if(y.isEqual(d[c],b))return d.splice(c,1),void this.total--},call:function(a,b){var c,d=this[a],e=d.length;if(0!==e)if(1===e)"end"===a?d[0].invoke():d[0].invoke(b);else for(d=l(d),c=0;e>c;c++)"end"===a?d[c].invoke():d[c].invoke(b)},isEmpty:function(){return 0===this.total}}),T.Observable=A,e(A.prototype,{_name:"observable",_onActivation:function(){},_onDeactivation:function(){},_setActive:function(a){this._active!==a&&(this._active=a,a?this._onActivation():this._onDeactivation())},_clear:function(){this._setActive(!1),this._alive=!1,this._subscribers=null},_send:function(a,b,c){this._alive&&(this._subscribers.call(a,b),this._subscribers.call("any",{type:a,value:b,current:!!c}),"end"===a&&this._clear())},_callWithCurrent:function(a,b,c,d){b=y(b),a===c?"value"===a?b.invoke(d):b.invoke():"any"===a&&b.invoke({type:c,value:d,current:!0})},on:function(a,b){return this._alive?(this._subscribers.add(a,b),this._setActive(!0)):this._callWithCurrent(a,b,"end"),this},off:function(a,b){return this._alive&&(this._subscribers.remove(a,b),this._subscribers.isEmpty()&&this._setActive(!1)),this},onValue:function(a){this.on("value",a)},onEnd:function(a){this.on("end",a)},onAny:function(a){this.on("any",a)},offValue:function(a){this.off("value",a)},offEnd:function(a){this.off("end",a)},offAny:function(a){this.off("any",a)}}),A.prototype.toString=function(){return"["+this._name+"]"},T.Stream=B,f(B,A,{_name:"stream"}),T.Property=C,f(C,A,{_name:"property",_send:function(a,b,c){this._alive&&(c||(this._subscribers.call(a,b),this._subscribers.call("any",{type:a,value:b,current:!1})),"value"===a&&(this._current=b),"end"===a&&this._clear())},on:function(a,b){return this._alive&&(this._subscribers.add(a,b),this._setActive(!0)),this._current!==P&&this._callWithCurrent(a,b,"value",this._current),this._alive||this._callWithCurrent(a,b,"end"),this}}),A.prototype.log=function(a){return this.onAny([D,null,a||this.toString()]),this},A.prototype.offLog=function(a){return this.offAny([D,null,a||this.toString()]),this},v("withInterval",{_init:function(a){this._fn=y(a[0],1);var b=this;this._$send=function(a,c){b._send(a,c)}},_free:function(){this._fn=null,this._$send=null},_onTick:function(){this._fn.invoke(this._$send)}}),v("fromPoll",{_init:function(a){this._fn=y(a[0],0)},_free:function(){this._fn=null},_onTick:function(){this._send("value",this._fn.invoke())}}),v("interval",{_init:function(a){this._x=a[0]},_free:function(){this._x=null},_onTick:function(){this._send("value",this._x)}}),v("sequentially",{_init:function(a){this._xs=l(a[0]),0===this._xs.length&&this._send("end")},_free:function(){this._xs=null},_onTick:function(){switch(this._xs.length){case 1:this._send("value",this._xs[0]),this._send("end");break;default:this._send("value",this._xs.shift())}}}),v("repeatedly",{_init:function(a){this._xs=l(a[0]),this._i=-1},_onTick:function(){this._xs.length>0&&(this._i=(this._i+1)%this._xs.length,this._send("value",this._xs[this._i]))}}),v("later",{_init:function(a){this._x=a[0]},_free:function(){this._x=null},_onTick:function(){this._send("value",this._x),this._send("end")}}),f(E,B,{_name:"merge",_onActivation:function(){var a,b=this._sources.length;for(this._aliveCount=b,a=0;b>a;a++)this._sources[a].onAny([this._handleAny,this])},_onDeactivation:function(){var a,b=this._sources.length;for(a=0;b>a;a++)this._sources[a].offAny([this._handleAny,this])},_handleAny:function(a){"value"===a.type?this._send("value",a.value,a.current):(this._aliveCount--,0===this._aliveCount&&this._send("end",null,a.current))},_clear:function(){B.prototype._clear.call(this),this._sources=null}}),T.merge=function(){return new E(g(arguments))},A.prototype.merge=function(a){return T.merge([this,a])},f(F,B,{_name:"sampledBy",_onActivation:function(){var a,b=this._sources.length;for(this._aliveCount=b-this._passiveCount,this._activating=!0,a=0;b>a;a++)this._sources[a].onAny([this._handleAny,this,a]);this._activating=!1,this._emitAfterActivation&&(this._emitAfterActivation=!1,this._emitIfFull(!0)),this._endAfterActivation&&this._send("end",null,!0)},_onDeactivation:function(){var a,b=this._sources.length;for(a=0;b>a;a++)this._sources[a].offAny([this._handleAny,this,a])},_emitIfFull:function(a){if(!n(this._currents,P)){var b=l(this._currents);this._combinator&&(b=this._combinator.apply(this._currents)),this._send("value",b,a)}},_handleAny:function(a,b){"value"===b.type?(this._currents[a]=b.value,a>=this._passiveCount&&(this._activating?this._emitAfterActivation=!0:this._emitIfFull(b.current))):a>=this._passiveCount&&(this._aliveCount--,0===this._aliveCount&&(this._activating?this._endAfterActivation=!0:this._send("end",null,b.current)))},_clear:function(){B.prototype._clear.call(this),this._sources=null,this._currents=null}}),T.sampledBy=function(a,b,c){return new F(a,b,c)},A.prototype.sampledBy=function(a,b){return T.sampledBy([this],[a],b)},T.combine=function(a,b){var c=new F([],a,b);return c._name="combine",c},A.prototype.combine=function(a,b){return T.combine([this,a],b)},f(G,B,{_name:"abstractPool",_sub:function(a){a.onAny([this._handleSubAny,this]),a.onEnd([this._remove,this,a])},_unsub:function(a){a.offAny([this._handleSubAny,this]),a.offEnd([this._remove,this,a])},_handleSubAny:function(a){"value"===a.type&&this._send("value",a.value,a.current)},_add:function(a){this._sources.push(a),this._active&&this._sub(a)},_remove:function(a){this._active&&this._unsub(a);for(var b=0;b<this._sources.length;b++)if(this._sources[b]===a)return void this._sources.splice(b,1)},_onActivation:function(){for(var a=l(this._sources),b=0;b<a.length;b++)this._sub(a[b])},_onDeactivation:function(){for(var a=0;a<this._sources.length;a++)this._unsub(this._sources[a])}}),f(H,G,{_name:"pool",add:function(a){return this._add(a),this},remove:function(a){return this._remove(a),this}}),T.pool=function(){return new H},f(I,G,{_onActivation:function(){G.prototype._onActivation.call(this),this._source.onAny([this._handleMainSource,this])},_onDeactivation:function(){G.prototype._onDeactivation.call(this),this._source.offAny([this._handleMainSource,this])},_handleMainSource:function(a){"value"===a.type?(a.current&&this._lastValue===a.value||this._add(this._fn?this._fn.invoke(a.value):a.value),this._lastValue=a.value):0===this._sources.length?this._send("end",null,a.current):this._mainEnded=!0},_remove:function(a){G.prototype._remove.call(this,a),this._mainEnded&&0===this._sources.length&&this._send("end")},_clear:function(){G.prototype._clear.call(this),this._source=null,this._lastValue=null}}),A.prototype.flatMap=function(a){return new I(this,a)},w("toProperty",{_init:function(a){a.length>0&&this._send("value",a[0])}},{propertyMethod:null,streamMethod:K}),w("changes",{_handleValue:function(a,b){b||this._send("value",a)}},{streamMethod:null,propertyMethod:J}),w("withHandler",{_init:function(a){this._handler=y(a[0],2),this._forcedCurrent=!1;var b=this;this._$send=function(a,c){b._send(a,c,b._forcedCurrent)}},_free:function(){this._handler=null,this._$send=null},_handleAny:function(a){this._forcedCurrent=a.current,this._handler.invoke(this._$send,a),this._forcedCurrent=!1}});var U={_init:function(a){this._fn=y(a[0],1)},_free:function(){this._fn=null}};w("map",e({_handleValue:function(a,b){this._send("value",this._fn.invoke(a),b)}},U)),w("filter",e({_handleValue:function(a,b){this._fn.invoke(a)&&this._send("value",a,b)}},U)),w("takeWhile",e({_handleValue:function(a,b){this._fn.invoke(a)?this._send("value",a,b):this._send("end",null,b)}},U)),w("take",{_init:function(a){this._n=a[0],this._n<=0&&this._send("end")},_handleValue:function(a,b){this._n--,this._send("value",a,b),0===this._n&&this._send("end")}}),w("skip",{_init:function(a){this._n=a[0]<0?0:a[0]},_handleValue:function(a,b){0===this._n?this._send("value",a,b):this._n--}}),w("skipDuplicates",{_init:function(a){this._fn=a[0]&&y(a[0],2),this._prev=P},_free:function(){this._fn=null,this._prev=null},_isEqual:function(a,b){return this._fn?this._fn.invoke(a,b):a===b},_handleValue:function(a,b){this._prev!==P&&this._isEqual(this._prev,a)||(this._send("value",a,b),this._prev=a)}}),w("skipWhile",{_init:function(a){this._fn=y(a[0],1),this._skip=!0},_free:function(){this._fn=null},_handleValue:function(a,b){return this._skip?void(this._fn.invoke(a)||(this._skip=!1,this._fn=null,this._send("value",a,b))):void this._send("value",a,b)}}),w("diff",{_init:function(a){this._prev=a[0],this._fn=y(a[1],2)},_free:function(){this._prev=null,this._fn=null},_handleValue:function(a,b){this._send("value",this._fn.invoke(this._prev,a),b),this._prev=a}}),w("scan",{_init:function(a){this._send("value",a[0],!0),this._fn=y(a[1],2)},_free:function(){this._fn=null},_handleValue:function(a,b){this._send("value",this._fn.invoke(this._current,a),b)}},{streamMethod:K}),w("reduce",{_init:function(a){this._result=a[0],this._fn=y(a[1],2)},_free:function(){this._fn=null,this._result=null},_handleValue:function(a){this._result=this._fn.invoke(this._result,a)},_handleEnd:function(a,b){this._send("value",this._result,b),this._send("end",null,b)}}),w("throttle",{_init:function(a){this._wait=a[0],this._leading=b(a[1],"leading",!0),this._trailing=b(a[1],"trailing",!0),this._trailingCallValue=null,this._trailingCallTimeoutId=null,this._endAfterTrailingCall=!1,this._lastCallTime=0;var c=this;this._$makeTrailingCall=function(){c._makeTrailingCall()}},_free:function(){this._trailingCallValue=null,this._$makeTrailingCall=null},_handleValue:function(a,b){if(b)this._send("value",a,b);else{var c=Q();0!==this._lastCallTime||this._leading||(this._lastCallTime=c);var d=this._wait-(c-this._lastCallTime);0>=d?(this._cancelTralingCall(),this._lastCallTime=c,this._send("value",a)):this._trailing&&this._scheduleTralingCall(a,d)}},_handleEnd:function(a,b){b?this._send("end",null,b):this._trailingCallTimeoutId?this._endAfterTrailingCall=!0:this._send("end")},_scheduleTralingCall:function(a,b){this._trailingCallTimeoutId&&this._cancelTralingCall(),this._trailingCallValue=a,this._trailingCallTimeoutId=setTimeout(this._$makeTrailingCall,b)},_cancelTralingCall:function(){null!==this._trailingCallTimeoutId&&(clearTimeout(this._trailingCallTimeoutId),this._trailingCallTimeoutId=null)},_makeTrailingCall:function(){this._send("value",this._trailingCallValue),this._trailingCallTimeoutId=null,this._trailingCallValue=null,this._lastCallTime=this._leading?Q():0,this._endAfterTrailingCall&&this._send("end")}}),w("delay",{_init:function(a){this._wait=a[0],this._buff=[];var b=this;this._shiftBuff=function(){b._send("value",b._buff.shift())}},_free:function(){this._buff=null,this._shiftBuff=null},_handleValue:function(a,b){b?this._send("value",a,b):(this._buff.push(a),setTimeout(this._shiftBuff,this._wait))},_handleEnd:function(a,b){if(b)this._send("end",null,b);else{var c=this;setTimeout(function(){c._send("end")},this._wait)}}}),f(L,B,{_name:"fromBinder",_onActivation:function(){var a=this,b=!0;this._unsubscribe=this._fn.invoke(function(c,d){a._send(c,d,b)}),b=!1},_onDeactivation:function(){q(this._unsubscribe)&&this._unsubscribe(),this._unsubscribe=null},_clear:function(){B.prototype._clear.call(this),this._fn=null}}),T.fromBinder=function(a){return new L(a)},f(M,B,{_name:"emitter",emit:function(a){this._send("value",a)},end:function(){this._send("end")}}),T.emitter=function(){return new M};var V=new B;V._send("end"),V._name="never",T.never=function(){return V},f(N,C,{_name:"constant"}),T.constant=function(a){return new N(a)},f(O,B,{_name:"once",_onActivation:function(){this._send("value",this._value),this._send("end")}}),T.once=function(a){return new O(a)},A.prototype.setName=function(a,b){return this._name=b?a._name+"."+b:a,this},A.prototype.mapTo=function(a){return this.map(function(){return a}).setName(this,"mapTo")},A.prototype.pluck=function(a){return this.map(function(b){return b[a]}).setName(this,"pluck")},A.prototype.invoke=function(a){var b=o(arguments,1);return this.map(b?function(c){return i(c[a],c,b)}:function(b){return b[a]()}).setName(this,"invoke")},A.prototype.tap=function(a){return a=y(a,1),this.map(function(b){return a.invoke(b),b}).setName(this,"tap")},A.prototype.defer=function(){return this.delay(0).setName(this,"defer")},T.and=function(a){return T.combine(a,t).setName("and")},A.prototype.and=function(a){return this.combine(a,t).setName("and")},T.or=function(a){return T.combine(a,u).setName("or")},A.prototype.or=function(a){return this.combine(a,u).setName("or")},A.prototype.not=function(){return this.map(function(a){return!a}).setName("not")},A.prototype.awaiting=function(a){return T.merge([this.mapTo(!0),a.mapTo(!1)]).skipDuplicates().toProperty(!1).setName(this,"awaiting")},A.prototype.filterBy=function(a){return a.sampledBy(this).withHandler(function(a,b){"end"===b.type?a("end"):b.value[0]&&a("value",b.value[1])}).setName(this,"filterBy")},"function"==typeof define&&define.amd?(define([],function(){return T}),a.Kefir=T):"object"==typeof module&&"object"==typeof exports?(module.exports=T,T.Kefir=T):a.Kefir=T}(this);
//# sourceMappingURL=kefir.min.js.map